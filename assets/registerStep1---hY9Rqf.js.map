{"version":3,"file":"registerStep1---hY9Rqf.js","sources":["../../src/views/signIn/registerStep1.vue"],"sourcesContent":["<template>\r\n  <v-form @submit.prevent=\"submit\" v-model=\"valid\" class=\"mx-auto register-form\">\r\n    <h2 class=\"text-center mb-3\">一般帳號註冊</h2>\r\n\r\n    <div v-for=\"(value, key) in info\" :key=\"key\" class=\"label-container text-start mt-3\">\r\n      <span class=\"label-item\">{{ getLabel(key) }}</span> <span class=\"label-item\">{{ value }}</span>\r\n    </div>\r\n    <v-text-field hide-details=\"auto\" v-model=\"form.code\" density=\"compact\" label=\"驗證碼\"\r\n      prepend-inner-icon=\"mdi-lock-check\" variant=\"solo\" required :rules=\"[codeRule]\" class=\"register-item mb-2\">\r\n      <template #label>\r\n        <span class=\"text-danger\">*</span>驗證碼\r\n      </template>\r\n      <template #append-inner>\r\n        <v-btn v-if=\"countdown > 0\" variant=\"tonal\" color=\"primary\" size=\"small\">\r\n          <p style=\"white-space: nowrap;\">{{ countdown }}秒 重新發送</p>\r\n        </v-btn>\r\n        <v-btn v-else @click=\"sendEmailVarifyCode(query.email)\" variant=\"flat\" color=\"primary\" size=\"small\">\r\n          <p style=\"white-space: nowrap; color: white !important;\">重新發送</p>\r\n        </v-btn>\r\n      </template>\r\n    </v-text-field>\r\n\r\n    <v-btn type=\"submit\" variant=\"flat\" color=\"primary\" block class=\"mt-5\" :loading=\"loading\">\r\n      驗證\r\n    </v-btn>\r\n\r\n    <div class=\"or\">或</div>\r\n    <router-link to=\"/sign-in\" class=\"text-decoration-none\">回登入</router-link>\r\n  </v-form>\r\n</template>\r\n\r\n<script setup>\r\nimport { useReCaptcha } from \"vue-recaptcha-v3\";\r\nimport { emailRule, nameRule, userNumberRule } from \"@/rules\";\r\nimport { authenticator } from \"../../requests\";\r\n\r\nconst router = useRouter();\r\nconst { executeRecaptcha } = useReCaptcha();\r\n\r\nconst loading = ref(false);\r\nconst valid = ref(true);\r\nconst error = ref(\"\");\r\nconst showPw = ref(false);\r\nconst showConfirmPw = ref(false);\r\n\r\nconst form = ref({\r\n  userName: \"\",\r\n  name: \"\",\r\n  email: \"\",\r\n  code: \"\",\r\n});\r\nconst info = ref({\r\n  userName: \"\",\r\n  name: \"\",\r\n  email: \"\",\r\n});\r\nconst labels = {\r\n  userName: \"帳號/員工編號\",\r\n  name: \"姓名\",\r\n  email: \"信箱\",\r\n};\r\n\r\nonMounted(() => {\r\n  const query = router.currentRoute.value.query;\r\n  info.value.userName = query.userName || \"\";\r\n  info.value.name = query.name || \"\";\r\n  info.value.email = query.email || \"\";\r\n  form.value.userName = query.userName || \"\";\r\n  form.value.name = query.name || \"\";\r\n  form.value.email = query.email || \"\";\r\n  startCountdown();\r\n  sendEmailVarifyCode(query.email);\r\n});\r\n\r\nconst getLabel = (key) => labels[key] || key;\r\n\r\nconst countdown = ref(0);\r\nlet countdownInterval = null;\r\nfunction startCountdown() {\r\n  if (countdown.value > 0) return;\r\n\r\n  countdown.value = 60;\r\n  countdownInterval = setInterval(() => {\r\n    if (countdown.value > 0) {\r\n      countdown.value--;\r\n    } else {\r\n      clearInterval(countdownInterval);\r\n    }\r\n  }, 1000);\r\n}\r\n\r\nfunction sendEmailVarifyCode(email) {\r\n  authenticator.getEmailVarifyCode(email).then(() => {\r\n    startCountdown();\r\n  });\r\n}\r\n\r\nconst submit = async () => {\r\n  const rules = [emailRule, nameRule, userNumberRule];\r\n  authenticator.getDataFromTISS(form.value.email, form.value.code).then((a) => {\r\n    const data = a.data;\r\n    console.log(a);\r\n    if (a.status === 200) {\r\n      loading.value = true;\r\n      router.push({\r\n        path: '/sign-in/registerStep2', query: {\r\n          email: form.value.email,\r\n          name: form.value.name,\r\n          userName: form.value.userName,\r\n          gender: \"男\",\r\n          unit: \"運動中心\",\r\n        }\r\n      });\r\n    } else {\r\n      alert(\"驗證碼錯誤，請重新輸入。\");\r\n    }\r\n  }).catch(() => {\r\n    alert(\"驗證碼錯誤，請重新輸入。\");\r\n  });\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.register-form {\r\n  min-width: 60%;\r\n}\r\n\r\n.register-item {\r\n  border-radius: 10px !important;\r\n  margin-top: 18px;\r\n}\r\n\r\n.register-item .v-field {\r\n  height: 25px;\r\n}\r\n\r\n.register-item .v-input__control {\r\n  box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.5) !important;\r\n  background-color: white;\r\n}\r\n\r\n:global(.right .register-item .v-input__details .v-messages__message) {\r\n  color: lightcoral !important;\r\n}\r\n\r\n:global(.register-item .v-field) {\r\n  border-radius: 10px !important;\r\n}\r\n\r\n:global(.right .register-item .v-input__control *) {\r\n  color: gray !important;\r\n}\r\n\r\n:global(.right .register-item .text-danger) {\r\n  color: red !important;\r\n}\r\n\r\n.label-container {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  min-width: 280px;\r\n}\r\n\r\n.label-item {\r\n  flex: 1;\r\n  min-width: 100px;\r\n}\r\n</style>"],"names":["router","useRouter","executeRecaptcha","useReCaptcha","loading","ref","valid","form","info","labels","onMounted","query","startCountdown","sendEmailVarifyCode","getLabel","key","countdown","countdownInterval","email","authenticator","submit","_createBlock","_component_v_form","_unref","$event","_cache","_createElementVNode","_openBlock","_createElementBlock","_Fragment","_renderList","value","_hoisted_1","_toDisplayString","_hoisted_2","_createVNode","_component_v_text_field","codeRule","_component_v_btn","_hoisted_3","_component_router_link"],"mappings":"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"}
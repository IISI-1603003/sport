{"version":3,"file":"radarChart-D5zA25RN.js","sources":["../../src/views/dashboard/psychology/components/radarChart.vue"],"sourcesContent":["<template>\r\n  <v-btn-toggle v-model=\"currentViewMode\" mandatory color=\"primary\" border>\r\n    <v-btn :value=\"viewMode.INDICATOR\" size=\"small\">\r\n      向度\r\n    </v-btn>\r\n    <v-btn :value=\"viewMode.SKILL\" size=\"small\">\r\n      技能\r\n    </v-btn>\r\n  </v-btn-toggle>\r\n  <div ref=\"chartContainer\" class=\"chart-container\"></div>\r\n</template>\r\n\r\n<script setup>\r\nimport * as echarts from 'echarts'\r\n\r\nconst allDates = inject('allDates')\r\nconst responsePsychology = inject('responsePsychology')\r\n\r\n// 雷達圖視圖模式\r\nconst viewMode = {\r\n  INDICATOR: 'indicator', // 向度視圖\r\n  SKILL: 'skill'         // 技能視圖\r\n}\r\nconst SKILL_ORDER = ['基礎', '身心', '認知', '腦波']\r\n\r\n// 13個關鍵指標名稱\r\nconst INDICATOR_NAMES = [\r\n  '目標設定',\r\n  '自信心', \r\n  '承諾',\r\n  '意象',\r\n  '心理練習',\r\n  '再專注',\r\n  '專注',\r\n  '比賽計畫',\r\n  '活化',\r\n  '放鬆',\r\n  '恐懼控制',\r\n  '壓力反應',\r\n  '自動化'\r\n]\r\n\r\n\r\n// 內部視圖模式狀態\r\nconst currentViewMode = ref(viewMode.INDICATOR)\r\n\r\nconst hasData = computed(() => {\r\n  return responsePsychology?.value && responsePsychology?.value.length > 0 && allDates.value.length > 0\r\n})\r\n\r\nconst chartContainer = ref(null)\r\nlet chartInstance = null\r\n\r\n// 計算雷達圖指標軸\r\nconst radarIndicators = computed(() => {\r\n  if (currentViewMode.value === viewMode.SKILL) {\r\n    // 技能視圖：顯示4個技能分類\r\n    return SKILL_ORDER.map(skillName => ({\r\n      name: skillName,\r\n      max: 5\r\n    }))\r\n  } else {\r\n    // 向度視圖：顯示所有指標（排除自動化）\r\n    return INDICATOR_NAMES.filter(name => name !== '自動化').map(name => ({\r\n      name: name,\r\n      max: 5\r\n    }))\r\n  }\r\n})\r\n\r\n// 格式化雷達圖數據\r\nconst formatRadarData = () => {\r\n  if (!responsePsychology.value || responsePsychology.value.length === 0) {\r\n    console.log('no responsePsychology');\r\n    return []\r\n  }\r\n\r\n  // 確保選中的日期按時間順序排列\r\n  const sortedDates = [...allDates.value].sort((a, b) => new Date(a) - new Date(b))\r\n\r\n  return sortedDates.map((date, index) => {\r\n    const dateData = responsePsychology.value.find(d => d.date === date)\r\n    if (!dateData) return null\r\n\r\n    let values = []\r\n\r\n    if (currentViewMode.value === viewMode.SKILL) {\r\n      // 技能視圖：計算每個技能分類的平均分數\r\n      values = SKILL_ORDER.map(skillName => {\r\n        const skill = PSYCHOLOGY_SKILL_CATEGORIES[skillName]\r\n        const indicators = Object.keys(skill.indicators)\r\n\r\n        if (indicators.length === 0) return 0\r\n\r\n        const sum = indicators.reduce((acc, indicator) => {\r\n          return acc + (dateData[indicator] || 0)\r\n        }, 0)\r\n\r\n        return Math.round((sum / indicators.length) * 100) / 100\r\n      })\r\n    } else {\r\n      // 向度視圖：顯示各個指標分數（排除自動化）\r\n      values = INDICATOR_NAMES.filter(name => name !== '自動化').map(indicator => {\r\n        return dateData[indicator] || 0\r\n      })\r\n    }\r\n\r\n    const color = CHART_COLORS[index % CHART_COLORS.length]\r\n\r\n    return {\r\n      name: date,\r\n      value: values,\r\n      itemStyle: {\r\n        color: color\r\n      },\r\n      lineStyle: {\r\n        color: color,\r\n        width: 2\r\n      },\r\n      areaStyle: {\r\n        color: color,\r\n        opacity: 0.15\r\n      },\r\n      symbol: 'circle',\r\n      symbolSize: 6\r\n    }\r\n  }).filter(item => item !== null)\r\n}\r\n\r\n// 更新圖表\r\nconst updateChart = () => {\r\n  if (!chartInstance) {\r\n    console.log('Chart instance not initialized');\r\n    return\r\n  }\r\n\r\n  // 防止無數據時觸發渲染\r\n  if (!hasData.value) {\r\n    console.log('No Data');\r\n    chartInstance.clear()\r\n    chartInstance.setOption({\r\n      title: {\r\n        text: '沒有資料',\r\n        left: 'center',\r\n        top: 'middle',\r\n        textStyle: {\r\n          color: '#999',\r\n          fontSize: 20\r\n        }\r\n      }\r\n    })\r\n    return\r\n  }\r\n\r\n  const option = {\r\n    tooltip: {\r\n      trigger: 'item',\r\n      backgroundColor: 'rgba(50, 50, 50, 0.9)',\r\n      borderColor: '#ccc',\r\n      borderWidth: 1,\r\n      textStyle: {\r\n        color: '#fff',\r\n        fontSize: 12\r\n      },\r\n      formatter: function (params) {\r\n        const { name, value, color } = params\r\n        let content = `<div style=\"margin-bottom: 8px;\"><strong style=\"color: ${color};\">${name}</strong></div>`\r\n\r\n        radarIndicators.value.forEach((indicator, index) => {\r\n          const score = value[index]\r\n          content += `<div style=\"margin: 2px 0;\">${indicator.name}: <strong>${score}</strong></div>`\r\n        })\r\n\r\n        return content\r\n      }\r\n    },\r\n    legend: {\r\n      data: allDates.value,\r\n      top: 10,\r\n      textStyle: {\r\n        fontSize: 14\r\n      },\r\n      itemGap: 20,\r\n      selectedMode: 'multiple'\r\n    },\r\n    radar: {\r\n      indicator: radarIndicators.value,\r\n      center: ['50%', '55%'],\r\n      radius: '70%',\r\n      axisName: {\r\n        fontSize: 12,\r\n        color: '#666'\r\n      },\r\n      splitLine: {\r\n        lineStyle: {\r\n          color: '#e0e0e0'\r\n        }\r\n      },\r\n      axisLine: {\r\n        lineStyle: {\r\n          color: '#ccc'\r\n        }\r\n      },\r\n      splitArea: {\r\n        show: true,\r\n        areaStyle: {\r\n          color: ['rgba(250,250,250,0.1)', 'rgba(200,200,200,0.1)']\r\n        }\r\n      }\r\n    },\r\n    series: [{\r\n      type: 'radar',\r\n      data: formatRadarData(),\r\n      symbol: 'circle',\r\n      symbolSize: 6,\r\n      lineStyle: {\r\n        width: 2\r\n      }\r\n    }]\r\n  }\r\n\r\n  chartInstance.setOption(option, true)\r\n}\r\n\r\nconst initChart = () => {\r\n  chartInstance = echarts.init(chartContainer.value)\r\n\r\n  updateChart()\r\n}\r\n\r\nwatch(\r\n  [() => responsePsychology?.value, allDates, currentViewMode],\r\n  () => {\r\n    if (chartInstance && responsePsychology.value) {\r\n      updateChart()\r\n    }\r\n  },\r\n  { deep: true }\r\n)\r\n\r\nconst handleResize = () => {\r\n  if (chartInstance) {\r\n    chartInstance.resize()\r\n  }\r\n}\r\n\r\n// 生命週期\r\nonMounted(() => {\r\n  nextTick(() => {\r\n    initChart()\r\n  })\r\n  window.addEventListener('resize', handleResize)\r\n})\r\n\r\nonUnmounted(() => {\r\n  if (chartInstance) {\r\n    chartInstance.dispose()\r\n    chartInstance = null\r\n  }\r\n  window.removeEventListener('resize', handleResize)\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.chart-container {\r\n  width: 100%;\r\n  height: 400px;\r\n  min-height: 400px;\r\n}\r\n</style>"],"names":["allDates","inject","responsePsychology","viewMode","SKILL_ORDER","INDICATOR_NAMES","currentViewMode","ref","hasData","computed","chartContainer","chartInstance","radarIndicators","skillName","name","formatRadarData","a","b","date","index","dateData","d","values","skill","PSYCHOLOGY_SKILL_CATEGORIES","indicators","sum","acc","indicator","color","CHART_COLORS","item","updateChart","option","params","value","content","score","initChart","echarts.init","watch","handleResize","onMounted","nextTick","onUnmounted","_createVNode","_component_v_btn_toggle","_unref","$event","_component_v_btn","_cache","_createElementVNode"],"mappings":"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"}
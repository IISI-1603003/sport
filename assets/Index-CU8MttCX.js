import{a as p,o as s,b as g,z as k,j as c,t as j,D as J,w as i,m as V,J as $,e as r,f as K,i as f,d as o,n as E,u as t,F as B,y as I,V as T,aE as M,q as F,p as z}from"./index-C1z4PiDl.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as P}from"./VTextarea-BP4hdr6I.js";import{V as L}from"./VContainer-O0FrbM2N.js";import{V as D,a as U}from"./VRow-C8T6qQjI.js";import{V as O}from"./VSnackbar-BM3RUT0S.js";/* empty css              */import"./layout-B4EBgczh.js";const Q={class:"item"},G={class:"label"},H={class:"value"},W={key:4},X={__name:"editField",props:{label:{type:String,required:!0},modelValue:{type:[String,Number],default:""},isEditing:{type:Boolean,default:!1},type:{type:String,default:"text",validator:a=>["text","textarea","select"].includes(a)},inputType:{type:String,default:"text"},rows:{type:Number,default:2},options:{type:Array,default:()=>[]},chipStyle:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(a){return(u,d)=>(s(),p("div",Q,[g("div",G,k(a.label),1),g("div",H,[a.isEditing&&a.type==="text"?(s(),c(j,{key:0,"model-value":a.modelValue,"onUpdate:modelValue":d[0]||(d[0]=m=>u.$emit("update:modelValue",m)),variant:"outlined",density:"compact","hide-details":"",type:a.inputType},null,8,["model-value","type"])):a.isEditing&&a.type==="textarea"?(s(),c(P,{key:1,"model-value":a.modelValue,"onUpdate:modelValue":d[1]||(d[1]=m=>u.$emit("update:modelValue",m)),variant:"outlined",density:"compact",rows:a.rows||2,"hide-details":""},null,8,["model-value","rows"])):a.isEditing&&a.type==="select"?(s(),c(J,{key:2,"model-value":a.modelValue,"onUpdate:modelValue":d[2]||(d[2]=m=>u.$emit("update:modelValue",m)),items:a.options,variant:"outlined",density:"compact","hide-details":""},null,8,["model-value","items"])):!a.isEditing&&a.chipStyle?(s(),c($,{key:3,color:"secondary",size:"small",variant:"flat",class:"chip",rounded:"lg"},{default:i(()=>[V(k(a.modelValue),1)]),_:1})):(s(),p("span",W,k(a.modelValue),1))])]))}},x=A(X,[["__scopeId","data-v-9848bcf4"]]),Y={class:"profile-section"},Z={class:"red"},_={key:0,class:"search-input-wrapper"},ee={key:0,class:"view-list"},ae={key:1,class:"box",style:{background:"aliceblue"}},te={__name:"Index",setup(a){const u=r({}),d=r(!1),m=r({}),h=r([]),y=r([]),N=r(!1),b=r(""),v=r(!1),w=r("");K(async()=>{const n=await f.get("/api/my/data");u.value=n.data;const e=await f.get("/api/userusers/my/userDown");h.value=e.data.map(l=>l.userName),await R()});const R=async()=>{try{const n=await f.get("/api/userusers/my/userUp");y.value=n.data}catch(n){console.error("載入檢視者清單失敗",n)}},S=async()=>{try{const n=await f.get(`/api/users/check/${b.value.trim()}`),{keyNo:e,userName:l}=n.data;if(y.value.some(C=>C.keyNo===e)){w.value="該檢視者已在名單中",v.value=!0;return}await f.post("/api/userusers/my/userUp",JSON.stringify(e),{headers:{"Content-Type":"application/json"}}),y.value.push({keyNo:e,userName:l}),b.value="",N.value=!1}catch(n){n.response?.status===404?w.value="找不到該使用者":w.value="新增失敗，請稍後再試",v.value=!0}},q=async n=>{try{await f.delete(`/api/userusers/my/${n}`),y.value=y.value.filter(e=>e.keyNo!==n)}catch{w.value="刪除失敗，請稍後再試",v.value=!0}};return(n,e)=>(s(),c(L,{fluid:"",class:"pa-2"},{default:i(()=>[o(D,{justify:"center"},{default:i(()=>[o(U,{cols:"12",md:"10",lg:"9"},{default:i(()=>[o(D,{class:"mb-1"},{default:i(()=>[o(U,{cols:"12",md:"6",class:"pe-md-8"},{default:i(()=>[g("div",null,[o(x,{label:"姓名","model-value":t(u).userName},null,8,["model-value"]),o(x,{label:"性別","model-value":t(u).sex,"is-editing":t(d)},null,8,["model-value","is-editing"])])]),_:1}),o(U,{cols:"12",md:"6",class:"ps-md-8"},{default:i(()=>[g("div",Y,[o(x,{label:"信箱","model-value":t(d)?t(m).email:t(u).email,"is-editing":t(d),"input-type":"email","onUpdate:modelValue":e[0]||(e[0]=l=>t(m).email=l)},null,8,["model-value","is-editing"]),o(x,{label:"單位","model-value":t(u).unitName},null,8,["model-value"])])]),_:1})]),_:1}),e[6]||(e[6]=g("label",{class:"view-list"},"檢視者",-1)),g("div",Z,[(s(!0),p(B,null,I(t(y),l=>(s(),c($,{key:l.keyNo,color:"primary",closable:"",class:"ma-1","onClick:close":C=>q(l.keyNo)},{default:i(()=>[o(T,{start:""},{default:i(()=>[...e[4]||(e[4]=[V("mdi-account",-1)])]),_:1}),V(" "+k(l.userName),1)]),_:2},1032,["onClick:close"]))),128)),t(N)?(s(),p("div",_,[o(j,{modelValue:t(b),"onUpdate:modelValue":e[1]||(e[1]=l=>F(b)?b.value=l:null),density:"compact",variant:"outlined",placeholder:"請輸入完整姓名","hide-details":"",class:"search-input",autofocus:"",onKeyup:M(S,["enter"])},{"append-inner":i(()=>[o(z,{icon:"mdi-magnify",size:"small",variant:"text",onClick:S})]),_:1},8,["modelValue"])])):(s(),c(z,{key:1,icon:"",size:"small",color:"cyan",variant:"flat",class:"add-btn",onClick:e[2]||(e[2]=l=>N.value=!0)},{default:i(()=>[o(T,null,{default:i(()=>[...e[5]||(e[5]=[V("mdi-plus",-1)])]),_:1})]),_:1}))]),t(h).length>0?(s(),p("label",ee,"可檢視名單")):E("",!0),t(h).length>0?(s(),p("div",ae,[(s(!0),p(B,null,I(t(h),l=>(s(),c($,{color:"primary",class:"ma-1"},{default:i(()=>[V(k(l),1)]),_:2},1024))),256))])):E("",!0)]),_:1})]),_:1}),o(O,{modelValue:t(v),"onUpdate:modelValue":e[3]||(e[3]=l=>F(v)?v.value=l:null),timeout:3e3,color:"error"},{default:i(()=>[V(k(t(w)),1)]),_:1},8,["modelValue"])]),_:1}))}},me=A(te,[["__scopeId","data-v-e21533d0"]]);export{me as default};

import{f as d,H as O,z as A,E as D,h as F,b as u,e as i,w as s,F as v,p as H,o as m,m as w,d as p,s as x,x as I,l as M,j as q,I as G}from"./index-YoOYIYhl.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as E,a as k}from"./VRow-D6SN89O4.js";import{V as Q}from"./VDialog-BSkNhZq1.js";import{V as W}from"./VSelect-DiAXwcwV.js";import{V,b as X}from"./VBtn-BoYJvvf3.js";import{V as P,a as Y,b as U,c as Z}from"./VCard-BoE4UQs3.js";import{V as K}from"./VTextField-Ct49Ao8i.js";import{V as R}from"./VCheckbox-Bh5E8y3W.js";import{V as ee}from"./VSpacer-DddgVSoQ.js";/* empty css              */import"./index-C7nfzMpl.js";import"./VOverlay-DPnezZc_.js";import"./scopeId-DMVw-0Yq.js";import"./index-BfXC6dQ1.js";import"./forwardRefs-B9O2pm3w.js";import"./VList-C4kwG3hb.js";import"./VAvatar-DEknT8tg.js";const te={class:"d-flex align-center"},ae={class:"permissions-tree"},le={key:0,class:"permission-category"},ie={class:"ms-8"},se={__name:"rolePermissions",setup(oe){H();const f=d(!1),b=d(!1),n=d(""),c=d(""),y=d([{id:"admin",name:"系統管理員"},{id:"coach",name:"教練"},{id:"analyst",name:"數據分析師"},{id:"doctor",name:"醫療人員"},{id:"athlete",name:"選手"}]),r=d([{id:"physiological",name:"生理監控",nameEn:"Physiological",items:[{id:"template1",name:"選手生理監測儀表板"},{id:"template2",name:"生理狀態綜合儀表板"},{id:"template3",name:"運動生理數據總覽"}]},{id:"psychological",name:"心理監控",nameEn:"Psychological",items:[{id:"template1",name:"心理健康與壓力監控儀表板"},{id:"template2",name:"選手心理狀態追蹤儀表板"},{id:"template3",name:"心理與恢復趨勢總覽"}]},{id:"nutrition",name:"營養監控",nameEn:"Nutrition / Hydration",items:[{id:"template1",name:"水分補給與代謝監控儀表板"},{id:"template2",name:"營養補給行為分析儀表板"},{id:"template3",name:"飲水與汗液電解平衡儀表板"}]},{id:"performance",name:"體能監控",nameEn:"Performance",items:[{id:"template1",name:"體能表現與爆發力分析儀表板"},{id:"template2",name:"跳躍能力與肌肉性分析儀表板"}]}]),l=O({});(()=>{r.value.forEach(t=>{l[t.id]={selected:!1,indeterminate:!1,expanded:!0,items:{}},t.items.forEach(e=>{l[t.id].items[e.id]=!1})})})(),A(()=>!!n.value);const _=async t=>{if(t){f.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),T(t)}catch(e){console.error("載入權限失敗:",e)}finally{f.value=!1}}},T=t=>{switch(g(),t){case"admin":j(!0);break;case"coach":l.physiological.items.template1=!0,l.psychological.items.template1=!0,l.nutrition.items.template1=!0,l.performance.items.template1=!0;break;case"analyst":l.physiological.items.template2=!0,l.psychological.items.template3=!0,l.nutrition.items.template2=!0,l.performance.items.template2=!0;break;case"doctor":l.physiological.items.template1=!0,l.physiological.items.template2=!0,l.psychological.items.template1=!0;break;case"athlete":l.physiological.items.template1=!0,l.psychological.items.template2=!0;break}z()},j=t=>{r.value.forEach(e=>{e.items.forEach(a=>{l[e.id].items[a.id]=t}),l[e.id].selected=t,l[e.id].indeterminate=!1})},B=t=>{const e=l[t],a=!e.selected||e.indeterminate;Object.keys(e.items).forEach(o=>{e.items[o]=a}),C(t)},C=t=>{const e=l[t],a=Object.values(e.items),o=a.filter(S=>S).length,h=a.length;o===0?(e.selected=!1,e.indeterminate=!1):o===h?(e.selected=!0,e.indeterminate=!1):(e.selected=!1,e.indeterminate=!0)},z=()=>{r.value.forEach(t=>{C(t.id)})},g=()=>{r.value.forEach(t=>{l[t.id].selected=!1,l[t.id].indeterminate=!1,t.items.forEach(e=>{l[t.id].items[e.id]=!1})})},$=async()=>{if(!n.value){alert("請先選擇角色");return}b.value=!0;try{const t={};r.value.forEach(e=>{t[e.id]=[],e.items.forEach(a=>{l[e.id].items[a.id]&&t[e.id].push(a.id)})}),await new Promise(e=>setTimeout(e,1500)),console.log("儲存權限設定:",{roleId:n.value,permissions:t}),alert("權限設定已儲存")}catch(t){console.error("儲存權限失敗:",t),alert("儲存失敗，請重試")}finally{b.value=!1}},L=async()=>{if(!n.value){alert("請先選擇角色");return}try{const t=new Blob(["權限清查表內容"],{type:"application/zip"}),e=window.URL.createObjectURL(t),a=document.createElement("a");a.href=e,a.download=`權限清查表_${n.value}_${new Date().getTime()}.zip`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(e)}catch(t){console.error("下載失敗:",t),alert("下載失敗，請重試")}},N=()=>{c.value.trim()&&console.log("搜尋權限:",c.value)};return D(c,t=>{t||r.value.forEach(e=>{l[e.id].expanded=!0})}),F(()=>{y.value.length>0&&(n.value=y.value[0].id,_(n.value))}),(t,e)=>(m(),u(v,null,[i(E,null,{default:s(()=>[i(k,{cols:"12",md:"4"},{default:s(()=>[i(W,{modelValue:n.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>n.value=a),_],items:y.value,"item-title":"name","item-value":"id",label:"選擇角色",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),i(k,{cols:"12",md:"8",class:"d-flex justify-end"},{default:s(()=>[i(V,{color:"primary","prepend-icon":"mdi-download",onClick:L},{default:s(()=>[...e[3]||(e[3]=[w(" 下載權限清查表 ",-1)])]),_:1})]),_:1})]),_:1}),i(E,null,{default:s(()=>[i(k,{cols:"12"},{default:s(()=>[i(P,{class:"permission-card"},{default:s(()=>[i(Y,{class:"d-flex justify-space-between align-center"},{default:s(()=>[e[4]||(e[4]=p("span",null,"儀表板",-1)),p("div",te,[i(K,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),"prepend-inner-icon":"mdi-magnify",placeholder:"搜尋",variant:"outlined",density:"compact",width:"300","hide-details":"",clearable:"",class:"me-2"},null,8,["modelValue"]),i(V,{color:"primary",onClick:N,text:"尋找"})])]),_:1}),i(U,null,{default:s(()=>[p("div",ae,[(m(!0),u(v,null,x(r.value,a=>(m(),u(v,{key:a.id},[l[a.id]?(m(),u("div",le,[i(R,{modelValue:l[a.id].selected,"onUpdate:modelValue":o=>l[a.id].selected=o,indeterminate:l[a.id].indeterminate,"hide-details":"",label:`${a.name} (${a.nameEn})`,color:"teal",class:"category-checkbox",onChange:o=>B(a.id)},null,8,["modelValue","onUpdate:modelValue","indeterminate","label","onChange"]),M(p("div",ie,[(m(!0),u(v,null,x(a.items,o=>(m(),q(R,{key:o.id,modelValue:l[a.id].items[o.id],"onUpdate:modelValue":h=>l[a.id].items[o.id]=h,label:o.name,"hide-details":"",color:"teal",class:"subcategory-checkbox",onChange:h=>C(a.id)},null,8,["modelValue","onUpdate:modelValue","label","onChange"]))),128))],512),[[G,l[a.id].expanded]])])):I("",!0)],64))),128))])]),_:1}),i(Z,{class:"pa-4"},{default:s(()=>[i(ee),i(V,{color:"grey",variant:"outlined",onClick:g},{default:s(()=>[...e[5]||(e[5]=[w(" 重置 ",-1)])]),_:1}),i(V,{color:"primary",onClick:$,loading:b.value},{default:s(()=>[...e[6]||(e[6]=[w(" 儲存設定 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),i(Q,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=a=>f.value=a),persistent:"",width:"300"},{default:s(()=>[i(P,null,{default:s(()=>[i(U,{class:"text-center pa-6"},{default:s(()=>[i(X,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),e[7]||(e[7]=p("div",null,"載入中...",-1))]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Ee=J(se,[["__scopeId","data-v-ea3886c3"]]);export{Ee as default};

import{c as v,o as s,a as b,x as w,h as c,q as D,B as K,w as i,k,H as S,d as r,e as M,ag as g,b as o,l as B,u as t,F as U,t as E,V as T,ah as P,n as F,m as z}from"./index-Dfwmr34z.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as H}from"./VTextarea-BStWpN5Z.js";import{V as J}from"./VContainer-OEFnmiWo.js";import{V as A,a as $}from"./VRow-BxR3TJ0q.js";import{V as L}from"./VSnackbar-Byw-mOFw.js";/* empty css              */import"./layout-BY2do3K7.js";const O={class:"item"},Q={class:"label"},G={class:"value"},W={key:4},X={__name:"editField",props:{label:{type:String,required:!0},modelValue:{type:[String,Number],default:""},isEditing:{type:Boolean,default:!1},type:{type:String,default:"text",validator:a=>["text","textarea","select"].includes(a)},inputType:{type:String,default:"text"},rows:{type:Number,default:2},options:{type:Array,default:()=>[]},chipStyle:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(a){return(d,n)=>(s(),v("div",O,[b("div",Q,w(a.label),1),b("div",G,[a.isEditing&&a.type==="text"?(s(),c(D,{key:0,"model-value":a.modelValue,"onUpdate:modelValue":n[0]||(n[0]=m=>d.$emit("update:modelValue",m)),variant:"outlined",density:"compact","hide-details":"",type:a.inputType},null,8,["model-value","type"])):a.isEditing&&a.type==="textarea"?(s(),c(H,{key:1,"model-value":a.modelValue,"onUpdate:modelValue":n[1]||(n[1]=m=>d.$emit("update:modelValue",m)),variant:"outlined",density:"compact",rows:a.rows||2,"hide-details":""},null,8,["model-value","rows"])):a.isEditing&&a.type==="select"?(s(),c(K,{key:2,"model-value":a.modelValue,"onUpdate:modelValue":n[2]||(n[2]=m=>d.$emit("update:modelValue",m)),items:a.options,variant:"outlined",density:"compact","hide-details":""},null,8,["model-value","items"])):!a.isEditing&&a.chipStyle?(s(),c(S,{key:3,color:"secondary",size:"small",variant:"flat",class:"chip",rounded:"lg"},{default:i(()=>[k(w(a.modelValue),1)]),_:1})):(s(),v("span",W,w(a.modelValue),1))])]))}},x=R(X,[["__scopeId","data-v-9848bcf4"]]),Y={class:"profile-section"},Z={class:"red"},_={key:0,class:"search-input-wrapper"},ee={key:0,class:"view-list"},ae={key:1,class:"box",style:{background:"aliceblue"}},te={__name:"Index",setup(a){const d=r({}),n=r(!1),m=r({}),h=r([]),y=r([]),N=r(!1),f=r(""),p=r(!1),V=r("");M(async()=>{const u=await g.get("/api/my/data");d.value=u.data;const e=await g.get("/api/useruser/my/userDown");h.value=e.data.map(l=>l.userName),await j()});const j=async()=>{try{const u=await g.get("/api/useruser/my/userUp");y.value=u.data}catch(u){console.error("載入檢視者清單失敗",u)}},C=async()=>{if(f.value.trim().length<2){V.value="請輸入至少2個字元",p.value=!0;return}try{const u=await g.get(`/api/users/check/${f.value.trim()}`),{userId:e,userName:l}=u.data;if(y.value.some(I=>I.userId===e)){V.value="該檢視者已在名單中",p.value=!0;return}await g.post("/api/useruser/my/userUp",JSON.stringify(e),{headers:{"Content-Type":"application/json"}}),y.value.push({userId:e,userName:l}),f.value="",N.value=!1}catch(u){u.response?.status===404?V.value="找不到該使用者":V.value="新增失敗，請稍後再試",p.value=!0}},q=async u=>{try{await g.delete(`/api/useruser/my/${u}`),y.value=y.value.filter(e=>e.userId!==u)}catch{V.value="刪除失敗，請稍後再試",p.value=!0}};return(u,e)=>(s(),c(J,{fluid:"",class:"pa-2"},{default:i(()=>[o(A,{justify:"center"},{default:i(()=>[o($,{cols:"12",md:"10",lg:"9"},{default:i(()=>[o(A,{class:"mb-1"},{default:i(()=>[o($,{cols:"12",md:"6",class:"pe-md-8"},{default:i(()=>[b("div",null,[o(x,{label:"姓名","model-value":t(d).userName},null,8,["model-value"]),o(x,{label:"性別","model-value":t(d).sex,"is-editing":t(n)},null,8,["model-value","is-editing"])])]),_:1}),o($,{cols:"12",md:"6",class:"ps-md-8"},{default:i(()=>[b("div",Y,[o(x,{label:"信箱","model-value":t(n)?t(m).email:t(d).email,"is-editing":t(n),"input-type":"email","onUpdate:modelValue":e[0]||(e[0]=l=>t(m).email=l)},null,8,["model-value","is-editing"]),o(x,{label:"單位","model-value":t(d).unitName},null,8,["model-value"])])]),_:1})]),_:1}),e[6]||(e[6]=b("label",{class:"view-list"},"檢視者",-1)),b("div",Z,[(s(!0),v(U,null,E(t(y),l=>(s(),c(S,{key:l.userId,color:"primary",closable:"",class:"ma-1","onClick:close":I=>q(l.userId)},{default:i(()=>[o(T,{start:""},{default:i(()=>[...e[4]||(e[4]=[k("mdi-account",-1)])]),_:1}),k(" "+w(l.userName),1)]),_:2},1032,["onClick:close"]))),128)),t(N)?(s(),v("div",_,[o(D,{modelValue:t(f),"onUpdate:modelValue":e[1]||(e[1]=l=>F(f)?f.value=l:null),density:"compact",variant:"outlined",placeholder:"請輸入完整姓名","hide-details":"",class:"search-input",autofocus:"",onKeyup:P(C,["enter"])},{"append-inner":i(()=>[o(z,{icon:"mdi-magnify",size:"small",variant:"text",onClick:C})]),_:1},8,["modelValue"])])):(s(),c(z,{key:1,icon:"",size:"small",color:"cyan",variant:"flat",class:"add-btn",onClick:e[2]||(e[2]=l=>N.value=!0)},{default:i(()=>[o(T,null,{default:i(()=>[...e[5]||(e[5]=[k("mdi-plus",-1)])]),_:1})]),_:1}))]),t(h).length>0?(s(),v("label",ee,"可檢視名單")):B("",!0),t(h).length>0?(s(),v("div",ae,[(s(!0),v(U,null,E(t(h),l=>(s(),c(S,{color:"primary",class:"ma-1"},{default:i(()=>[k(w(l),1)]),_:2},1024))),256))])):B("",!0)]),_:1})]),_:1}),o(L,{modelValue:t(p),"onUpdate:modelValue":e[3]||(e[3]=l=>F(p)?p.value=l:null),timeout:3e3,color:"error"},{default:i(()=>[k(w(t(V)),1)]),_:1},8,["modelValue"])]),_:1}))}},me=R(te,[["__scopeId","data-v-cb2e6c61"]]);export{me as default};

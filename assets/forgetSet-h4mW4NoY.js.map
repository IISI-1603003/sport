{"version":3,"file":"forgetSet-h4mW4NoY.js","sources":["../../src/views/signIn/forgetSet.vue"],"sourcesContent":["<template>\r\n  <v-form @submit.prevent=\"submit\" v-model=\"valid\" class=\"mx-auto register-form\">\r\n    <h2 class=\"text-center\">修改密碼</h2>\r\n    <p class=\"text-center mt-5\">已將驗證碼寄送至{{ form.email }}</p>\r\n    <p>請輸入驗證碼，修改密碼。</p>\r\n    <v-text-field hide-details=\"auto\" v-model=\"form.pw\" :type=\"showPw ? 'text' : 'password'\" density=\"compact\"\r\n      label=\"密碼\" prepend-inner-icon=\"mdi-lock\" variant=\"solo\" required class=\"register-item mb-2\" :rules=\"[pwRule]\">\r\n      <template #label>\r\n        <span class=\"text-danger\">*</span>密碼\r\n      </template>\r\n      <template #append-inner>\r\n        <v-icon @click=\"letPwVisible\" class=\"cursor-pointer\">\r\n          {{ showPw ? 'mdi-eye' : 'mdi-eye-off' }}\r\n        </v-icon>\r\n      </template>\r\n    </v-text-field>\r\n    <v-text-field hide-details=\"auto\" v-model=\"form.pwConfirm\" :type=\"showConfirmPw ? 'text' : 'password'\"\r\n      density=\"compact\" label=\"確認密碼\" prepend-inner-icon=\"mdi-lock-check\" variant=\"solo\" required\r\n      :rules=\"[value => pwConfirmRule(form.pw, value)]\" class=\"register-item mb-2\">\r\n      <template #label>\r\n        <span class=\"text-danger\">*</span>確認密碼\r\n      </template>\r\n      <template #append-inner>\r\n        <v-icon @click=\"letConfirmPwVisible\" class=\"cursor-pointer\">\r\n          {{ showConfirmPw ? 'mdi-eye' : 'mdi-eye-off' }}\r\n        </v-icon>\r\n      </template>\r\n    </v-text-field>\r\n    <v-text-field hide-details=\"auto\" v-model=\"form.code\" density=\"compact\" label=\"驗證碼\"\r\n      prepend-inner-icon=\"mdi-lock-check\" variant=\"solo\" required :rules=\"[codeRule]\" class=\"register-item mb-2\">\r\n      <template #label>\r\n        <span class=\"text-danger\">*</span>驗證碼\r\n      </template>\r\n      <template #append-inner>\r\n        <!-- <v-btn v-if=\"countdown > 0\" variant=\"tonal\" color=\"primary\" size=\"small\">\r\n          <p style=\"white-space: nowrap;\">{{ countdown }}秒 重新發送</p>\r\n        </v-btn>\r\n        <v-btn v-else @click=\"sendEmailVarifyCode(query.email)\" variant=\"tonal\" color=\"primary\" size=\"small\">\r\n          <p style=\"white-space: nowrap; cursor: pointer;\">重新發送</p>\r\n        </v-btn> -->\r\n        <v-btn v-if=\"countdown > 0\" variant=\"tonal\" color=\"primary\" size=\"small\">\r\n          <p style=\"white-space: nowrap;\">{{ countdown }}秒 重新發送</p>\r\n        </v-btn>\r\n        <v-btn v-else @click=\"reSend\" variant=\"flat\" color=\"primary\" size=\"small\">\r\n            <p style=\"white-space: nowrap; color: white !important;\">重新發送</p>\r\n        </v-btn>\r\n      </template>\r\n    </v-text-field>\r\n\r\n    <v-btn type=\"submit\" variant=\"flat\" color=\"primary\" block class=\"mt-5\" :loading=\"loading\">\r\n      確認\r\n    </v-btn>\r\n    <div class=\"or\">或</div>\r\n    <router-link to=\"/sign-in\" class=\"text-decoration-none\">\r\n      回登入\r\n    </router-link>\r\n  </v-form>\r\n</template>\r\n\r\n<script setup>\r\nimport { authentication } from \"@/requests\";\r\nimport { useReCaptcha } from \"vue-recaptcha-v3\";\r\nimport { useRouter } from \"vue-router\";\r\nimport { alertError } from \"@/helpers/functions\";\r\nimport { onMounted } from \"vue\";\r\nimport { emailRule, pwRule, pwConfirmRule, codeRule } from \"@/rules\";\r\n\r\nconst router = useRouter();\r\nconst { executeRecaptcha } = useReCaptcha();\r\n\r\nconst loading = ref(false);\r\nconst valid = ref(true);\r\nconst showPw = ref(false);\r\nconst showConfirmPw = ref(false);\r\n\r\nconst form = ref({\r\n  email: \"\",\r\n  pw: \"\",\r\n  pwConfirm: \"\",\r\n  code: \"\",\r\n});\r\nonMounted(() => {\r\n  form.value.email = router.currentRoute.value.query.email;\r\n  reSend();\r\n});\r\nfunction letPwVisible() {\r\n  showPw.value = !showPw.value;\r\n}\r\nfunction letConfirmPwVisible() {\r\n  showConfirmPw.value = !showConfirmPw.value;\r\n}\r\nconst submit = async () => {\r\n  const rules = [pwRule, codeRule];\r\n  for (const rule of rules) {\r\n    const result = rule(form.value[Object.keys(form.value).find(key => rule === eval(key + 'Rule'))]);\r\n    if (result !== true) {\r\n      alert(result);\r\n      return;\r\n    }\r\n  }\r\n  const pwConfirmResult = pwConfirmRule(form.value.pw, form.value.pwConfirm);\r\n  if (pwConfirmResult !== true) {\r\n    alert(result);\r\n    return;\r\n  }\r\n  loading.value = true;\r\n  authentication.forgetPwByEmail({\r\n    email: form.value.email,\r\n    newPw: form.value.pw,\r\n    verifyCode: form.value.code,\r\n  })\r\n    .then(() => {\r\n      alert(\"密碼修改成功，請使用新密碼登入\");\r\n      router.push('/sign-in/forgetSetSuccess');\r\n    })\r\n    .catch((e) => {\r\n      alert(e.response.data || \"系統異常，請稍後再試。\");\r\n    })\r\n    .finally(() => {\r\n      loading.value = false;\r\n    });\r\n};\r\nconst countdown = ref(0);\r\nlet countdownInterval = null;\r\nfunction startCountdown() {\r\n  if (countdown.value > 0) return;\r\n\r\n  countdown.value = 60;\r\n  countdownInterval = setInterval(() => {\r\n    if (countdown.value > 0) {\r\n      countdown.value--;\r\n    } else {\r\n      clearInterval(countdownInterval);\r\n    }\r\n  }, 1000);\r\n}\r\nfunction reSend() {\r\n  loading.value = true;\r\n  authentication.forgetPwVerifyCode(form.value.email)\r\n    .then(() => {\r\n      alert(\"已寄送驗證碼，如未收到請檢查垃圾信件匣\");\r\n      startCountdown();\r\n    })\r\n    .catch((e) => {\r\n      alert(e.response.data || \"系統異常，請稍後再試。\");\r\n    })\r\n    .finally(() => {\r\n      loading.value = false;\r\n    });\r\n}\r\n</script>\r\n<style scoped>\r\n.register-form {\r\n  min-width: 60%;\r\n}\r\n\r\n.register-item {\r\n  border-radius: 10px !important;\r\n  margin-top: 18px;\r\n}\r\n\r\n.register-item .v-field {\r\n  height: 25px;\r\n}\r\n\r\n.register-item .v-input__control {\r\n  box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.5) !important;\r\n  background-color: white;\r\n}\r\n\r\n:global(.right .register-item .v-input__details .v-messages__message) {\r\n  color: lightcoral !important;\r\n}\r\n\r\n:global(.register-item .v-field) {\r\n  border-radius: 10px !important;\r\n}\r\n\r\n:global(.right .register-item .v-input__control *) {\r\n  color: gray !important;\r\n}\r\n\r\n:global(.right .register-item .text-danger) {\r\n  color: red !important;\r\n}\r\n\r\n.label-container {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  min-width: 280px;\r\n}\r\n\r\n.label-item {\r\n  flex: 1;\r\n  min-width: 100px;\r\n}\r\n</style>\r\n"],"names":["useReCaptcha","e","_createBlock","_component_v_form","_unref","$event","_cache","_createElementVNode","_toDisplayString","_createVNode","_component_v_text_field","_component_v_icon","value","_component_v_btn","_component_router_link"],"mappings":"iqBAmEA,MAAM,OAAS,UAAS,EAClB,CAAE,gBAAgB,EAAKA,0BAAAA,eAEvB,QAAU,IAAI,EAAK,EACnB,MAAQ,IAAI,EAAI,EAChB,OAAS,IAAI,EAAK,EAClB,cAAgB,IAAI,EAAK,EAEzB,KAAO,IAAI,CACf,MAAO,GACP,GAAI,GACJ,UAAW,GACX,KAAM,EACR,CAAC,EACD,UAAU,IAAM,CACd,KAAK,MAAM,MAAQ,OAAO,aAAa,MAAM,MAAM,MACnD,QACF,CAAC,EACD,SAAS,cAAe,CACtB,OAAO,MAAQ,CAAC,OAAO,KACzB,CACA,SAAS,qBAAsB,CAC7B,cAAc,MAAQ,CAAC,cAAc,KACvC,CACA,MAAM,OAAS,SAAY,CACzB,MAAM,MAAQ,CAAC,OAAQ,QAAQ,EAC/B,UAAW,QAAQ,MAAO,CACxB,MAAM,OAAS,KAAK,KAAK,MAAM,OAAO,KAAK,KAAK,KAAK,EAAE,KAAK,KAAO,OAAS,KAAK,IAAM,MAAM,CAAC,CAAC,CAAC,EAChG,GAAI,SAAW,GAAM,CACnB,MAAM,MAAM,EACZ,MACF,CACF,CACA,MAAM,gBAAkB,cAAc,KAAK,MAAM,GAAI,KAAK,MAAM,SAAS,EACzE,GAAI,kBAAoB,GAAM,CAC5B,MAAM,MAAM,EACZ,MACF,CACA,QAAQ,MAAQ,GAChB,eAAe,gBAAgB,CAC7B,MAAO,KAAK,MAAM,MAClB,MAAO,KAAK,MAAM,GAClB,WAAY,KAAK,MAAM,IAC3B,CAAG,EACE,KAAK,IAAM,CACV,MAAM,iBAAiB,EACvB,OAAO,KAAK,2BAA2B,CACzC,CAAC,EACA,MAAOC,GAAM,CACZ,MAAMA,EAAE,SAAS,MAAQ,aAAa,CACxC,CAAC,EACA,QAAQ,IAAM,CACb,QAAQ,MAAQ,EAClB,CAAC,CACL,EACM,UAAY,IAAI,CAAC,EACvB,IAAI,kBAAoB,KACxB,SAAS,gBAAiB,CACpB,UAAU,MAAQ,IAEtB,UAAU,MAAQ,GAClB,kBAAoB,YAAY,IAAM,CAChC,UAAU,MAAQ,EACpB,UAAU,QAEV,cAAc,iBAAiB,CAEnC,EAAG,GAAI,EACT,CACA,SAAS,QAAS,CAChB,QAAQ,MAAQ,GAChB,eAAe,mBAAmB,KAAK,MAAM,KAAK,EAC/C,KAAK,IAAM,CACV,MAAM,qBAAqB,EAC3B,gBACF,CAAC,EACA,MAAOA,GAAM,CACZ,MAAMA,EAAE,SAAS,MAAQ,aAAa,CACxC,CAAC,EACA,QAAQ,IAAM,CACb,QAAQ,MAAQ,EAClB,CAAC,CACL,0EApJEC,YAuDSC,MAAA,CAvDA,uBAAgB,OAAM,CAAA,SAAA,CAAA,aAAWC,MAAA,KAAA,oDAAA,MAAK,MAAAC,EAAA,MAAE,MAAM,0CACrD,IAAiC,CAAjCC,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAC,gBAAiC,KAAA,CAA7B,MAAM,aAAa,EAAC,OAAI,EAAA,GAC5BA,gBAAwD,IAAxD,WAA4B,WAAQC,gBAAGJ,MAAA,IAAA,EAAK,KAAK,EAAA,CAAA,EACjDE,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAC,gBAAmB,SAAhB,eAAY,EAAA,GACfE,YAUeC,WAAA,CAVD,eAAa,OAAgB,WAAAN,MAAA,IAAA,EAAK,GAAL,sBAAAE,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAD,GAAAD,MAAA,IAAA,EAAK,GAAEC,GAAG,KAAMD,MAAA,MAAA,EAAM,OAAA,WAAwB,QAAQ,UAC/F,MAAM,KAAK,qBAAmB,WAAW,QAAQ,OAAO,SAAA,GAAS,MAAM,qBAAsB,OAAQA,MAAA,MAAA,CAAM,IAChG,cACT,IAAkC,CAAA,GAAAE,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAAlCC,gBAAkC,OAAA,CAA5B,MAAM,aAAa,EAAC,IAAC,EAAA,kBAAO,MACpC,EAAA,MACW,uBACT,IAES,CAFTE,YAESE,MAAA,CAFA,QAAO,aAAc,MAAM,mCAClC,IAAwC,iCAArCP,MAAA,MAAA,EAAM,UAAA,aAAA,EAAA,CAAA,kDAIfK,YAWeC,WAAA,CAXD,eAAa,OAAgB,WAAAN,MAAA,IAAA,EAAK,UAAL,sBAAAE,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAD,GAAAD,MAAA,IAAA,EAAK,UAASC,GAAG,KAAMD,MAAA,aAAA,EAAa,OAAA,WAC7E,QAAQ,UAAU,MAAM,OAAO,qBAAmB,iBAAiB,QAAQ,OAAO,SAAA,GACjF,MAAK,CAAGQ,GAASR,MAAA,aAAA,EAAcA,MAAA,IAAA,EAAK,GAAIQ,CAAK,CAAA,EAAI,MAAM,uBAC7C,cACT,IAAkC,CAAA,GAAAN,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAAlCC,gBAAkC,OAAA,CAA5B,MAAM,aAAa,EAAC,IAAC,EAAA,kBAAO,QACpC,EAAA,MACW,uBACT,IAES,CAFTE,YAESE,MAAA,CAFA,QAAO,oBAAqB,MAAM,mCACzC,IAA+C,iCAA5CP,MAAA,aAAA,EAAa,UAAA,aAAA,EAAA,CAAA,kDAItBK,YAmBeC,WAAA,CAnBD,eAAa,OAAgB,WAAAN,MAAA,IAAA,EAAK,KAAL,sBAAAE,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAD,GAAAD,MAAA,IAAA,EAAK,KAAIC,GAAE,QAAQ,UAAU,MAAM,MAC5E,qBAAmB,iBAAiB,QAAQ,OAAO,SAAA,GAAU,OAAQD,MAAA,QAAA,CAAQ,EAAG,MAAM,uBAC3E,cACT,IAAkC,CAAA,GAAAE,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAAlCC,gBAAkC,OAAA,CAA5B,MAAM,aAAa,EAAC,IAAC,EAAA,kBAAO,OACpC,EAAA,MACW,uBAOT,IAEQ,CAFKH,MAAA,SAAA,EAAS,eAAtBF,YAEQW,KAAA,OAFoB,QAAQ,QAAQ,MAAM,UAAU,KAAK,0BAC/D,IAAyD,CAAzDN,gBAAyD,IAAzD,WAAyDC,gBAAtBJ,MAAA,SAAA,CAAS,EAAG,SAAM,CAAA,wBAEvDF,YAEQW,KAAA,OAFO,QAAO,OAAQ,QAAQ,OAAO,MAAM,UAAU,KAAK,0BAC9D,IAAiE,CAAA,GAAAP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAAjEC,gBAAiE,IAAA,CAA9D,MAAA,CAAA,cAAA,SAAA,MAAA,kBAAA,GAAsD,OAAI,EAAA,8CAKrEE,YAEQI,KAAA,CAFD,KAAK,SAAS,QAAQ,OAAO,MAAM,UAAU,MAAA,GAAM,MAAM,OAAQ,QAAST,MAAA,OAAA,oBAAS,IAE1F,CAAA,GAAAE,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,iBAF0F,OAE1F,EAAA,0BACAA,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAC,gBAAuB,MAAA,CAAlB,MAAM,IAAI,EAAC,IAAC,EAAA,GACjBE,YAEcK,EAAA,CAFD,GAAG,WAAW,MAAM,yCAAuB,IAExD,CAAA,GAAAR,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,iBAFwD,QAExD,EAAA"}
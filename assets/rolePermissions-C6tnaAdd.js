import{f as d,H as O,z as A,E as F,h as H,j as E,w as s,p as I,o as m,e as i,d as u,t as M,m as w,b as h,F as _,s as P,x as q,l as G,I as J}from"./index-BPIvlUNV.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as W}from"./VContainer-BWM5ovIt.js";import{V as k,a as v}from"./VRow-zdPA_CW8.js";import{V as X}from"./VSelect-M5n7up_f.js";import{V,b as Y}from"./VBtn-CBc-tgy0.js";import{V as U,a as Z,b as R,c as K}from"./VCard-D9UqDhZS.js";import{V as ee}from"./VTextField-5m6Sa4s4.js";import{V as T}from"./VCheckbox-DR_Cp2lG.js";import{V as te}from"./VSpacer-BIHAPHw2.js";import{V as ae}from"./VDialog-BX21Jn1V.js";/* empty css              */import"./index-BsaOryL5.js";import"./forwardRefs-BY221Wt4.js";import"./VList-iJBzu4Bc.js";import"./index-g1m_Awsw.js";import"./VAvatar-BZWpZ8FD.js";import"./VOverlay-DTqiEZUt.js";import"./scopeId-BGPnDkS9.js";const le={class:"d-flex align-center"},ie={class:"permissions-tree"},se={key:0,class:"permission-category"},oe={class:"ms-8"},ne={__name:"rolePermissions",setup(re){I();const p=d(!1),b=d(!1),n=d(""),c=d(""),y=d([{id:"admin",name:"系統管理員"},{id:"coach",name:"教練"},{id:"analyst",name:"數據分析師"},{id:"doctor",name:"醫療人員"},{id:"athlete",name:"選手"}]),r=d([{id:"physiological",name:"生理監控",nameEn:"Physiological",items:[{id:"template1",name:"選手生理監測儀表板"},{id:"template2",name:"生理狀態綜合儀表板"},{id:"template3",name:"運動生理數據總覽"}]},{id:"psychological",name:"心理監控",nameEn:"Psychological",items:[{id:"template1",name:"心理健康與壓力監控儀表板"},{id:"template2",name:"選手心理狀態追蹤儀表板"},{id:"template3",name:"心理與恢復趨勢總覽"}]},{id:"nutrition",name:"營養監控",nameEn:"Nutrition / Hydration",items:[{id:"template1",name:"水分補給與代謝監控儀表板"},{id:"template2",name:"營養補給行為分析儀表板"},{id:"template3",name:"飲水與汗液電解平衡儀表板"}]},{id:"performance",name:"體能監控",nameEn:"Performance",items:[{id:"template1",name:"體能表現與爆發力分析儀表板"},{id:"template2",name:"跳躍能力與肌肉性分析儀表板"}]}]),l=O({});(()=>{r.value.forEach(t=>{l[t.id]={selected:!1,indeterminate:!1,expanded:!0,items:{}},t.items.forEach(e=>{l[t.id].items[e.id]=!1})})})(),A(()=>!!n.value);const g=async t=>{if(t){p.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),j(t)}catch(e){console.error("載入權限失敗:",e)}finally{p.value=!1}}},j=t=>{switch(x(),t){case"admin":B(!0);break;case"coach":l.physiological.items.template1=!0,l.psychological.items.template1=!0,l.nutrition.items.template1=!0,l.performance.items.template1=!0;break;case"analyst":l.physiological.items.template2=!0,l.psychological.items.template3=!0,l.nutrition.items.template2=!0,l.performance.items.template2=!0;break;case"doctor":l.physiological.items.template1=!0,l.physiological.items.template2=!0,l.psychological.items.template1=!0;break;case"athlete":l.physiological.items.template1=!0,l.psychological.items.template2=!0;break}z()},B=t=>{r.value.forEach(e=>{e.items.forEach(a=>{l[e.id].items[a.id]=t}),l[e.id].selected=t,l[e.id].indeterminate=!1})},$=t=>{const e=l[t],a=!e.selected||e.indeterminate;Object.keys(e.items).forEach(o=>{e.items[o]=a}),C(t)},C=t=>{const e=l[t],a=Object.values(e.items),o=a.filter(D=>D).length,f=a.length;o===0?(e.selected=!1,e.indeterminate=!1):o===f?(e.selected=!0,e.indeterminate=!1):(e.selected=!1,e.indeterminate=!0)},z=()=>{r.value.forEach(t=>{C(t.id)})},x=()=>{r.value.forEach(t=>{l[t.id].selected=!1,l[t.id].indeterminate=!1,t.items.forEach(e=>{l[t.id].items[e.id]=!1})})},S=async()=>{if(!n.value){alert("請先選擇角色");return}b.value=!0;try{const t={};r.value.forEach(e=>{t[e.id]=[],e.items.forEach(a=>{l[e.id].items[a.id]&&t[e.id].push(a.id)})}),await new Promise(e=>setTimeout(e,1500)),console.log("儲存權限設定:",{roleId:n.value,permissions:t}),alert("權限設定已儲存")}catch(t){console.error("儲存權限失敗:",t),alert("儲存失敗，請重試")}finally{b.value=!1}},L=async()=>{if(!n.value){alert("請先選擇角色");return}try{const t=new Blob(["權限清查表內容"],{type:"application/zip"}),e=window.URL.createObjectURL(t),a=document.createElement("a");a.href=e,a.download=`權限清查表_${n.value}_${new Date().getTime()}.zip`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(e)}catch(t){console.error("下載失敗:",t),alert("下載失敗，請重試")}},N=()=>{c.value.trim()&&console.log("搜尋權限:",c.value)};return F(c,t=>{t||r.value.forEach(e=>{l[e.id].expanded=!0})}),H(()=>{y.value.length>0&&(n.value=y.value[0].id,g(n.value))}),(t,e)=>(m(),E(W,{fluid:""},{default:s(()=>[i(k,null,{default:s(()=>[i(v,{cols:"12"},{default:s(()=>[u("h1",null,M(t.$root.subTitle),1)]),_:1})]),_:1}),i(k,null,{default:s(()=>[i(v,{cols:"12",md:"4"},{default:s(()=>[i(X,{modelValue:n.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>n.value=a),g],items:y.value,"item-title":"name","item-value":"id",label:"選擇角色",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),i(v,{cols:"12",md:"8",class:"d-flex justify-end"},{default:s(()=>[i(V,{color:"primary","prepend-icon":"mdi-download",onClick:L},{default:s(()=>[...e[3]||(e[3]=[w(" 下載權限清查表 ",-1)])]),_:1})]),_:1})]),_:1}),i(k,null,{default:s(()=>[i(v,{cols:"12"},{default:s(()=>[i(U,{class:"permission-card"},{default:s(()=>[i(Z,{class:"d-flex justify-space-between align-center"},{default:s(()=>[e[4]||(e[4]=u("span",null,"儀表板",-1)),u("div",le,[i(ee,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),"prepend-inner-icon":"mdi-magnify",placeholder:"搜尋",variant:"outlined",density:"compact",width:"300","hide-details":"",clearable:"",class:"me-2"},null,8,["modelValue"]),i(V,{color:"primary",onClick:N,text:"尋找"})])]),_:1}),i(R,null,{default:s(()=>[u("div",ie,[(m(!0),h(_,null,P(r.value,a=>(m(),h(_,{key:a.id},[l[a.id]?(m(),h("div",se,[i(T,{modelValue:l[a.id].selected,"onUpdate:modelValue":o=>l[a.id].selected=o,indeterminate:l[a.id].indeterminate,"hide-details":"",label:`${a.name} (${a.nameEn})`,color:"teal",class:"category-checkbox",onChange:o=>$(a.id)},null,8,["modelValue","onUpdate:modelValue","indeterminate","label","onChange"]),G(u("div",oe,[(m(!0),h(_,null,P(a.items,o=>(m(),E(T,{key:o.id,modelValue:l[a.id].items[o.id],"onUpdate:modelValue":f=>l[a.id].items[o.id]=f,label:o.name,"hide-details":"",color:"teal",class:"subcategory-checkbox",onChange:f=>C(a.id)},null,8,["modelValue","onUpdate:modelValue","label","onChange"]))),128))],512),[[J,l[a.id].expanded]])])):q("",!0)],64))),128))])]),_:1}),i(K,{class:"pa-4"},{default:s(()=>[i(te),i(V,{color:"grey",variant:"outlined",onClick:x},{default:s(()=>[...e[5]||(e[5]=[w(" 重置 ",-1)])]),_:1}),i(V,{color:"primary",onClick:S,loading:b.value},{default:s(()=>[...e[6]||(e[6]=[w(" 儲存設定 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),i(ae,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=a=>p.value=a),persistent:"",width:"300"},{default:s(()=>[i(U,null,{default:s(()=>[i(R,{class:"text-center pa-6"},{default:s(()=>[i(Y,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),e[7]||(e[7]=u("div",null,"載入中...",-1))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Re=Q(ne,[["__scopeId","data-v-50644d42"]]);export{Re as default};

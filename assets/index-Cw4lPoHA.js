import{A as m,f as _,h as g,B as l,b,o as f,j as h,w as p,e as s,m as v,t as j,u as x,C as T}from"./index-BPIvlUNV.js";import{a as c}from"./functions-D4rvsJVY.js";import{V as P,d as V}from"./VCard-D9UqDhZS.js";import{V as k,a as I}from"./VToolbar-CqnRKXDk.js";import"./index-BsaOryL5.js";import"./VAvatar-BZWpZ8FD.js";import"./index-g1m_Awsw.js";const w={__name:"tree",setup(y){const d=m("functions"),i=_(null),a=()=>{d.update()},u=()=>{l.get().then(o=>{$(i.value).jstree(!0).settings.core.data=o.data,$(i.value).jstree(!0).refresh()})};return g(()=>{$(i.value).jstree({plugins:["state","sort","dnd","types","contextmenu"],core:{check_callback(o,e,t,n,r){if(o==="delete_node")return confirm("確定要刪除嗎？");if(o==="move_node"&&!r.dnd)return confirm("確定要移動嗎？")},themes:{name:"default"}},sort:function(o,e){let t={menu:1,page:2,operation:3,api:4},n=t[this.get_type(o)],r=t[this.get_type(e)];if(n!=r)return n>r?1:-1},contextmenu:{items:function(o){var e=$.jstree.defaults.contextmenu.items();return delete e.create.action,e.create.submenu={menu:{label:"Menu",action:function(t){var n=$.jstree.reference(t.reference),r=n.get_node(t.reference);n.create_node(r,{type:"menu"},"last")}},page:{label:"Page",action:function(t){var n=$.jstree.reference(t.reference),r=n.get_node(t.reference);n.create_node(r,{type:"page"},"last")}},operation:{label:"Operation",action:function(t){var n=$.jstree.reference(t.reference),r=n.get_node(t.reference);n.create_node(r,{type:"operation"},"last")}},api:{label:"Api",action:function(t){var n=$.jstree.reference(t.reference),r=n.get_node(t.reference);n.create_node(r,{type:"api"},"last")}}},e.create.label="新增",e.rename.label="重新命名",e.remove.label="移除",e.ccp.label="動作",e.ccp.submenu.cut.label="剪下",e.ccp.submenu.copy.label="複製",e.ccp.submenu.paste.label="貼上",this.get_type(o)==="root"&&(delete e.create.submenu.page,delete e.create.submenu.operation,delete e.create.submenu.api,delete e.rename,delete e.remove,delete e.ccp.submenu.cut,delete e.ccp.submenu.copy),this.get_type(o)==="menu"&&(delete e.create.submenu.operation,delete e.create.submenu.api),this.get_type(o)==="page"&&delete e.create.submenu.menu,this.get_type(o)==="operation"&&(delete e.create.submenu.menu,delete e.create.submenu.page,delete e.create.submenu.operation),this.get_type(o)==="api"&&delete e.create,e}},types:{"#":{valid_children:["root"]},root:{valid_children:["menu"]},menu:{valid_children:["menu","page"],icon:"mdi mdi-folder text-warning"},page:{valid_children:["page","operation","api"],icon:"mdi mdi-file text-primary"},operation:{valid_children:["api"],icon:"mdi mdi-cog text-success"},api:{valid_children:[],icon:"mdi mdi-link text-red"}}}).on("delete_node.jstree",function(o,e){var t=e.instance.get_node(e.node.parent);l.delete({id:e.node.id,type:e.node.type},{id:e.node.id,parentId:t.original.id,parentType:t.type}).then(n=>{a()}).catch(c)}).on("create_node.jstree",function(o,e){var t=e.instance.get_node(e.node.parent);l.save({type:e.node.type},{text:e.node.text,parentId:t.original.id,parentType:t.type,position:e.position}).then(n=>{e.node.original.id=n.data.id,e.instance.set_id(e.node,n.data.id),e.instance.edit(e.node),a()}).catch(c)}).on("rename_node.jstree",function(o,e){var[t,n]=e.node.text.split(" /");l.rename({id:e.node.id,type:e.node.type},{id:e.node.id,text:t,url:n?"/"+n:null}).then(r=>{a()}).catch(c)}).on("move_node.jstree",function(o,e){var t=e.instance.get_node(e.parent),n=e.instance.get_node(e.old_parent);l.move({id:e.node.id,type:e.node.type},{id:e.node.id,parentId:t.original.id,parentType:t.type,position:e.position,oldParentId:n.original.id,oldParentType:n.type,oldPosition:e.old_position}).then(r=>{a()}).catch(c)}).on("copy_node.jstree",function(o,e){let t=e.instance.get_node(e.parent),n=e.instance.get_node(e.old_parent);l.copy({id:e.original.id,type:e.node.type},{id:e.original.id,type:e.node.type,parentId:t.original.id,parentType:t.type,oldParentId:n.original.id,oldParentType:n.type,position:e.position,oldPosition:e.old_position}).then(r=>{u(),a()}).catch(c)}),u()}),(o,e)=>(f(),b("div",{ref_key:"el",ref:i},null,512))}},O={__name:"index",setup(y){const d=m("menu"),i=_({id:null,icon:null}),a=()=>{d.value.load(!0)};return T("functions",{update:a,submit:()=>{l.update({id:i.value.id,type:i.value.type},i.value).then(o=>{a(),popup.value.hide()}).catch(c)}}),(o,e)=>(f(),h(P,null,{default:p(()=>[s(k,null,{default:p(()=>[s(I,null,{default:p(()=>[v(j(o.$root.subTitle),1)]),_:1})]),_:1}),s(V,null,{default:p(()=>[s(x(w))]),_:1})]),_:1}))}};export{O as default};

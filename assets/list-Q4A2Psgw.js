import{e as V,f as T,B as H,j as C,o as p,w as a,d as t,b as m,p as w,V as B,m as c,a as x,n as A,t as $,z as R,C as J,u as d,D as j,E,q as N,A as I,G as M,H as P,F as W,I as K,y as Q,J as X}from"./index-CRF8dQtn.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as q,a as z,b as S,c as F}from"./VCard-B5yvKPf8.js";import{V as Y}from"./VTextarea-7pjaMJiW.js";import{V as D}from"./VSpacer-CzGkPSvi.js";import{V as O}from"./VDialog-vemoKeCD.js";import{_ as Z}from"./delete-alert-icon-D8wzgUfY.js";import{V as _,a as G}from"./VRow-D9jdxu5n.js";/* empty css              */const h={class:"mt-4"},ee={key:0,class:"mt-4"},le={key:1},te={__name:"review",props:{user:{type:Object,required:!0,default:()=>({id:"",email:"",name:"",phone:"",unit:"",createTime:"",review:"",reason:"",rejectReason:"",roles:[]})}},emits:["review-user"],setup(v,{emit:k}){const n=v,y=V([]),i=V({id:"",review:"",rejectReason:"",roles:[]});T(()=>{i.value.id=n.user.id,i.value.review=n.user.review,i.value.rejectReason=n.user.rejectReason,i.value.roles=n.user.roles,H.list().then(u=>{y.value=u.data})});const s=V(!1),b=k;function g(){i.value.id=n.user.id,I.review(i.value).then(()=>{b("review-user",{...i.value}),s.value=!1}).catch(u=>{alert("審核失敗，請重新整理後再試一次")})}function U(){i.value.review=n.user.review,i.value.rejectReason=n.user.rejectReason,i.value.unit=n.user.unit,i.value.roles=n.user.roles,s.value=!1}return(u,l)=>(p(),C(O,{modelValue:d(s),"onUpdate:modelValue":l[9]||(l[9]=r=>N(s)?s.value=r:null),"max-width":"500"},{activator:a(({props:r})=>[t(w,E(r,{title:"審核狀態",size:"small",color:"warning",text:"審核"}),null,16)]),default:a(({isActive:r})=>[t(q,{class:"review-border"},{default:a(()=>[t(z,{class:"d-flex justify-space-between align-center"},{default:a(()=>[l[11]||(l[11]=m("span",{class:"text-blue"},"審核狀態",-1)),t(w,{icon:"",variant:"text",onClick:l[0]||(l[0]=e=>U())},{default:a(()=>[t(B,null,{default:a(()=>[...l[10]||(l[10]=[c("mdi-close",-1)])]),_:1})]),_:1})]),_:1}),t(S,null,{default:a(()=>[t($,{"hide-details":"auto",modelValue:v.user.email,"onUpdate:modelValue":l[1]||(l[1]=e=>v.user.email=e),density:"compact",label:"帳號/信箱","prepend-inner-icon":"mdi-email",variant:"solo",required:"",class:"mb-5",readonly:""},{label:a(()=>[...l[12]||(l[12]=[c(" 帳號/信箱 ",-1)])]),_:1},8,["modelValue"]),t($,{"hide-details":"auto",modelValue:v.user.name,"onUpdate:modelValue":l[2]||(l[2]=e=>v.user.name=e),density:"compact",label:"使用者名稱","prepend-inner-icon":"mdi-account",variant:"solo",required:"",class:"mb-5",readonly:""},{label:a(()=>[...l[13]||(l[13]=[c(" 使用者名稱 ",-1)])]),_:1},8,["modelValue"]),t($,{"hide-details":"auto",modelValue:v.user.unit,"onUpdate:modelValue":l[3]||(l[3]=e=>v.user.unit=e),density:"compact",label:"單位","prepend-inner-icon":"mdi-domain",variant:"solo",required:"",class:"mb-5",readonly:""},{label:a(()=>[...l[14]||(l[14]=[c(" 單位 ",-1)])]),_:1},8,["modelValue"]),m("div",null,[l[15]||(l[15]=m("strong",null,"申請原因:",-1)),c(" "+R(v.user.reason),1)]),m("div",null,[l[16]||(l[16]=m("strong",null,"申請時間:",-1)),c(" "+R(v.user.createTime),1)]),m("div",h,[l[19]||(l[19]=m("strong",null,"審核狀態:",-1)),t(J,{class:"mx-4",modelValue:d(i).review,"onUpdate:modelValue":l[4]||(l[4]=e=>d(i).review=e),mandatory:""},{default:a(()=>[t(w,{class:"review-button mx-4",value:"啟用",color:"success",variant:"tonal"},{default:a(()=>[...l[17]||(l[17]=[c("啟用",-1)])]),_:1}),t(w,{class:"review-button mx-4",value:"退件",color:"error",variant:"tonal"},{default:a(()=>[...l[18]||(l[18]=[c("退件",-1)])]),_:1})]),_:1},8,["modelValue"])]),d(i).review==="退件"?(p(),x("div",ee,[t(Y,{modelValue:d(i).rejectReason,"onUpdate:modelValue":l[5]||(l[5]=e=>d(i).rejectReason=e),label:"退件原因",density:"compact",variant:"solo",required:"",placeholder:"請輸入退件原因"},null,8,["modelValue"])])):A("",!0),d(i).review==="啟用"?(p(),x("div",le,[t(j,{modelValue:d(i).roles,"onUpdate:modelValue":l[6]||(l[6]=e=>d(i).roles=e),items:d(y),"item-title":"name","item-value":"id",label:"角色",variant:"underlined",chips:"",multiple:""},null,8,["modelValue","items"])])):A("",!0)]),_:1}),t(F,null,{default:a(()=>[t(D),t(w,{text:"取消",variant:"outlined",color:"grey-darken-2",onClick:l[7]||(l[7]=e=>U())}),t(w,{text:"確認",variant:"outlined",color:"primary",onClick:l[8]||(l[8]=e=>g())})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ae=L(te,[["__scopeId","data-v-df36a8da"]]),se={class:"mt-4"},re={key:0},ne={key:1},ie={__name:"edit",props:{user:{type:Object,required:!0,default:()=>({id:"",email:"",name:"",phone:"",unit:"",createTime:"",review:"",reason:"",rejectReason:"",roles:[]})}},emits:["edit-user"],setup(v,{emit:k}){const n=v,y=V([]),i=V([]),s=V({id:"",review:"",roles:[]});T(()=>{s.value.id=n.user.id,s.value.review=n.user.review,s.value.roles=n.user.roles,H.list().then(r=>{i.value=r.data}),M.get().then(r=>{y.value=r.data})});const b=V(!1),g=k;function U(){I.edit(s.value).then(()=>{g("edit-user",{...s.value}),b.value=!1}).catch(r=>{alert("編輯失敗，請重新整理後再試一次"),b.value=!1})}function u(){s.value.review=n.user.review,s.value.unit=n.user.unit,s.value.roles=n.user.roles,b.value=!1}function l(){s.value.review=s.value.review=="停用"?"啟用":"停用"}return(r,e)=>(p(),C(O,{modelValue:d(b),"onUpdate:modelValue":e[8]||(e[8]=o=>N(b)?b.value=o:null),"max-width":"500"},{activator:a(({props:o})=>[t(w,E(o,{title:"編輯",icon:"mdi-pencil",size:"small",variant:"text"}),null,16)]),default:a(({isActive:o})=>[t(q,{class:"review-border"},{default:a(()=>[t(z,{class:"d-flex justify-space-between align-center"},{default:a(()=>[e[10]||(e[10]=m("span",{class:"text-blue"},"編輯人員",-1)),t(w,{icon:"",variant:"text",onClick:e[0]||(e[0]=f=>u())},{default:a(()=>[t(B,null,{default:a(()=>[...e[9]||(e[9]=[c("mdi-close",-1)])]),_:1})]),_:1})]),_:1}),t(S,null,{default:a(()=>[t($,{"hide-details":"auto",modelValue:v.user.email,"onUpdate:modelValue":e[1]||(e[1]=f=>v.user.email=f),density:"compact",label:"帳號/信箱","prepend-inner-icon":"mdi-email",variant:"solo",required:"",class:"mb-5",readonly:""},{label:a(()=>[...e[11]||(e[11]=[c(" 帳號/信箱 ",-1)])]),_:1},8,["modelValue"]),t($,{"hide-details":"auto",modelValue:v.user.name,"onUpdate:modelValue":e[2]||(e[2]=f=>v.user.name=f),density:"compact",label:"使用者名稱","prepend-inner-icon":"mdi-account",variant:"solo",required:"",class:"mb-5",readonly:""},{label:a(()=>[...e[12]||(e[12]=[c(" 使用者名稱 ",-1)])]),_:1},8,["modelValue"]),t(j,{"hide-details":"auto",modelValue:d(s).unit,"onUpdate:modelValue":e[3]||(e[3]=f=>d(s).unit=f),items:d(y),"item-title":"unitName","item-value":"id",density:"compact",label:"單位","prepend-inner-icon":"mdi-domain",variant:"solo",required:"",class:"mb-5"},null,8,["modelValue","items"]),m("div",se,[e[15]||(e[15]=m("strong",null,"狀態:",-1)),t(w,{class:"review-button-edit mx-4",color:d(s).review==="啟用"?"success":"error",variant:"tonal",onClick:e[4]||(e[4]=f=>l())},{default:a(()=>[d(s).review==="啟用"?(p(),x("span",re,[...e[13]||(e[13]=[m("span",{class:"review-button-content"},"啟用",-1),m("span",{class:"review-button-circle"},"●",-1)])])):(p(),x("span",ne,[...e[14]||(e[14]=[m("span",{class:"review-button-circle"},"●",-1),m("span",{class:"review-button-content"},"停用",-1)])]))]),_:1},8,["color"])]),t(j,{modelValue:d(s).roles,"onUpdate:modelValue":e[5]||(e[5]=f=>d(s).roles=f),items:d(i),"item-title":"name","item-value":"id",label:"角色",variant:"underlined",chips:"",multiple:""},null,8,["modelValue","items"])]),_:1}),t(F,null,{default:a(()=>[t(D),t(w,{text:"取消",variant:"outlined",color:"grey-darken-2",onClick:e[6]||(e[6]=f=>u())}),t(w,{text:"確認",variant:"outlined",color:"primary",onClick:e[7]||(e[7]=f=>U())})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},oe=L(ie,[["__scopeId","data-v-f59914ed"]]),ue={__name:"delete",props:{user:{type:Object,required:!0,default:()=>({id:"",email:"",name:"",phone:"",unit:"",createTime:"",review:"",reason:"",rejectReason:"",roles:[]})}},emits:["delete-user"],setup(v,{emit:k}){const n=v,y=k,i=V({id:"",review:"",unit:"",roles:[]});T(()=>{i.value.review=n.user.review,i.value.unit=n.user.unit,i.value.roles=n.user.roles});const s=V(!1);function b(){y("delete-user",n.user.id),s.value=!1}function g(){s.value=!1}return(U,u)=>(p(),C(O,{modelValue:d(s),"onUpdate:modelValue":u[3]||(u[3]=l=>N(s)?s.value=l:null),"max-width":"500"},{activator:a(({props:l})=>[t(w,E(l,{title:"刪除",icon:"mdi-trash-can",size:"small",variant:"text"}),null,16)]),default:a(({isActive:l})=>[t(q,null,{default:a(()=>[t(z,{class:"d-flex justify-space-between align-center"},{default:a(()=>[u[5]||(u[5]=m("span",{class:"text-blue"},null,-1)),t(w,{icon:"",variant:"text",onClick:u[0]||(u[0]=r=>g())},{default:a(()=>[t(B,null,{default:a(()=>[...u[4]||(u[4]=[c("mdi-close",-1)])]),_:1})]),_:1})]),_:1}),t(S,null,{default:a(()=>[...u[6]||(u[6]=[m("div",{class:"delete-info"},[m("img",{src:Z,alt:"Delete Alert Icon",class:"delete-alert"}),m("span",null,[c("是否確認"),m("span",{class:"text-red"},"刪除"),c("?")])],-1)])]),_:1}),t(F,{class:"d-flex justify-center mb-5"},{default:a(()=>[t(w,{text:"取消",variant:"outlined",color:"grey-darken-2",onClick:u[1]||(u[1]=r=>g())}),t(D,{style:{flex:"0.25"}}),t(w,{text:"確認",variant:"outlined",color:"primary",onClick:u[2]||(u[2]=r=>b())})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},de=L(ue,[["__scopeId","data-v-e7c48700"]]),me={key:1,style:{color:"red"}},ve={key:2,style:{color:"green"}},fe={key:3,style:{color:"gray"}},pe={key:4},Re={__name:"list",setup(v){const k=V([]);T(()=>{l()});const n=V(""),y=V(""),i=P(()=>k.value.filter(r=>{const e=!n.value||r.name&&r.name.includes(n.value)||r.userName&&r.userName.includes(n.value)||r.email&&r.email.includes(n.value),o=!y.value||r.roles&&r.roles.includes(y.value);return e&&o}).sort((r,e)=>r.review==="待審核"&&e.review!=="待審核"?-1:r.review!=="待審核"&&e.review==="待審核"?1:new Date(e.createTime)-new Date(r.createTime))),s=V([{title:"使用者",key:"name"},{title:"帳號/E-mail",key:"email"},{title:"角色",key:"role"},{title:"單位",key:"unit"},{title:"狀態",key:"review",sortable:!1},{title:"編輯",key:"edit",sortable:!1},{title:"刪除",key:"delete",sortable:!1}]),b=V(["一般使用者","管理員","測試人員","師父","徒弟"]);function g(){l()}function U(){l()}function u(){l()}function l(){I.list().then(r=>{k.value=r.data})}return(r,e)=>(p(),x(W,null,[t(_,{class:"mt-1"},{default:a(()=>[t(G,{cols:"4"},{default:a(()=>[t(j,{label:"角色篩選",modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=o=>y.value=o),items:b.value,variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),t(D),t(G,{cols:"4"},{default:a(()=>[t($,{label:"搜尋",modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value=o),density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),t(q,{class:"rounded-lg elevation-3"},{default:a(()=>[t(K,{headers:s.value,items:i.value,density:"comfortable",class:"cyan-header"},{"item.role":a(({item:o})=>[(p(!0),x(W,null,Q(o.roles,f=>(p(),C(X,{key:f,class:"ma-1",color:"primary","text-color":"white",size:"small"},{default:a(()=>[c(R(f.name),1)]),_:2},1024))),128))]),"item.review":a(({item:o})=>[o.review==="待審核"?(p(),C(ae,{key:0,user:o,onReviewUser:g},null,8,["user"])):o.review==="退件"?(p(),x("span",me,R(o.review),1)):o.review==="啟用"?(p(),x("span",ve,R(o.review),1)):o.review==="停用"?(p(),x("span",fe,R(o.review),1)):(p(),x("span",pe,R(o.review),1))]),"item.edit":a(({item:o})=>[o.review!=="待審核"?(p(),C(oe,{key:0,user:{...o,roles:o.roles.map(f=>f.id)},onEditUser:U},null,8,["user"])):A("",!0)]),"item.delete":a(({item:o})=>[t(de,{user:o,onDeleteUser:u},null,8,["user"])]),_:1},8,["headers","items"])]),_:1})],64))}};export{Re as default};

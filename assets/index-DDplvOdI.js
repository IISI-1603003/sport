import{W as m,d as _,n as g,am as c,c as b,o as f,e as h,w as p,b as s,i as v,t as j,u as x,T}from"./index-BiqkCwdw.js";import{a as l}from"./functions-D4rvsJVY.js";import{V as P,a as k}from"./VCard-BQaM1i1z.js";import{c as I,d as V}from"./VToolbar-DepWNAGG.js";import"./index-DDpM6jXD.js";const w={__name:"tree",setup(y){const d=m("functions"),r=_(null),a=()=>{d.update()},u=()=>{c.get().then(o=>{$(r.value).jstree(!0).settings.core.data=o.data,$(r.value).jstree(!0).refresh()})};return g(()=>{$(r.value).jstree({plugins:["state","sort","dnd","types","contextmenu"],core:{check_callback(o,e,t,n,i){if(o==="delete_node")return confirm("確定要刪除嗎？");if(o==="move_node"&&!i.dnd)return confirm("確定要移動嗎？")},themes:{name:"default"}},sort:function(o,e){let t={menu:1,page:2,operation:3,api:4},n=t[this.get_type(o)],i=t[this.get_type(e)];if(n!=i)return n>i?1:-1},contextmenu:{items:function(o){var e=$.jstree.defaults.contextmenu.items();return delete e.create.action,e.create.submenu={menu:{label:"Menu",action:function(t){var n=$.jstree.reference(t.reference),i=n.get_node(t.reference);n.create_node(i,{type:"menu"},"last")}},page:{label:"Page",action:function(t){var n=$.jstree.reference(t.reference),i=n.get_node(t.reference);n.create_node(i,{type:"page"},"last")}},operation:{label:"Operation",action:function(t){var n=$.jstree.reference(t.reference),i=n.get_node(t.reference);n.create_node(i,{type:"operation"},"last")}},api:{label:"Api",action:function(t){var n=$.jstree.reference(t.reference),i=n.get_node(t.reference);n.create_node(i,{type:"api"},"last")}}},e.create.label="新增",e.rename.label="重新命名",e.remove.label="移除",e.ccp.label="動作",e.ccp.submenu.cut.label="剪下",e.ccp.submenu.copy.label="複製",e.ccp.submenu.paste.label="貼上",this.get_type(o)==="root"&&(delete e.create.submenu.page,delete e.create.submenu.operation,delete e.create.submenu.api,delete e.rename,delete e.remove,delete e.ccp.submenu.cut,delete e.ccp.submenu.copy),this.get_type(o)==="menu"&&(delete e.create.submenu.operation,delete e.create.submenu.api),this.get_type(o)==="page"&&delete e.create.submenu.menu,this.get_type(o)==="operation"&&(delete e.create.submenu.menu,delete e.create.submenu.page,delete e.create.submenu.operation),this.get_type(o)==="api"&&delete e.create,e}},types:{"#":{valid_children:["root"]},root:{valid_children:["menu"]},menu:{valid_children:["menu","page"],icon:"mdi mdi-folder text-warning"},page:{valid_children:["page","operation","api"],icon:"mdi mdi-file text-primary"},operation:{valid_children:["api"],icon:"mdi mdi-cog text-success"},api:{valid_children:[],icon:"mdi mdi-link text-red"}}}).on("delete_node.jstree",function(o,e){var t=e.instance.get_node(e.node.parent);c.delete({id:e.node.id,type:e.node.type},{id:e.node.id,parentId:t.original.id,parentType:t.type}).then(n=>{a()}).catch(l)}).on("create_node.jstree",function(o,e){var t=e.instance.get_node(e.node.parent);c.save({type:e.node.type},{text:e.node.text,parentId:t.original.id,parentType:t.type,position:e.position}).then(n=>{e.node.original.id=n.data.id,e.instance.set_id(e.node,n.data.id),e.instance.edit(e.node),a()}).catch(l)}).on("rename_node.jstree",function(o,e){var[t,n]=e.node.text.split(" /");c.rename({id:e.node.id,type:e.node.type},{id:e.node.id,text:t,url:n?"/"+n:null}).then(i=>{a()}).catch(l)}).on("move_node.jstree",function(o,e){var t=e.instance.get_node(e.parent),n=e.instance.get_node(e.old_parent);c.move({id:e.node.id,type:e.node.type},{id:e.node.id,parentId:t.original.id,parentType:t.type,position:e.position,oldParentId:n.original.id,oldParentType:n.type,oldPosition:e.old_position}).then(i=>{a()}).catch(l)}).on("copy_node.jstree",function(o,e){let t=e.instance.get_node(e.parent),n=e.instance.get_node(e.old_parent);c.copy({id:e.original.id,type:e.node.type},{id:e.original.id,type:e.node.type,parentId:t.original.id,parentType:t.type,oldParentId:n.original.id,oldParentType:n.type,position:e.position,oldPosition:e.old_position}).then(i=>{u(),a()}).catch(l)}),u()}),(o,e)=>(f(),b("div",{ref_key:"el",ref:r},null,512))}},A={__name:"index",setup(y){const d=m("menu"),r=_({id:null,icon:null}),a=()=>{d.value.load(!0)};return T("functions",{update:a,submit:()=>{c.update({id:r.value.id,type:r.value.type},r.value).then(o=>{a(),popup.value.hide()}).catch(l)}}),(o,e)=>(f(),h(P,null,{default:p(()=>[s(I,null,{default:p(()=>[s(V,null,{default:p(()=>[v(j(o.$root.subTitle),1)]),_:1})]),_:1}),s(k,null,{default:p(()=>[s(x(w))]),_:1})]),_:1}))}};export{A as default};

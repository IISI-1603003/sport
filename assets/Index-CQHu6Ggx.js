import{a as V,o as i,b,z as w,j as y,t as D,D as _,w as t,m as p,J as z,e as c,f as L,i as k,d as s,n as T,u as o,p as N,V as E,F as I,y as F,aE as Q,q as R}from"./index-mfJgyZhT.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as G}from"./VTextarea-D7m02IQK.js";import{V as H}from"./VContainer-DOiU4yey.js";import{V as j,a as S}from"./VRow-Ds-4XX6a.js";import{V as W}from"./VSnackbar-CYkhAcvC.js";/* empty css              */import"./layout-DtmpDlug.js";const X={class:"item"},Y={class:"label"},Z={class:"value"},ee={key:4},ae={__name:"editField",props:{label:{type:String,required:!0},modelValue:{type:[String,Number],default:""},isEditing:{type:Boolean,default:!1},type:{type:String,default:"text",validator:a=>["text","textarea","select"].includes(a)},inputType:{type:String,default:"text"},rows:{type:Number,default:2},options:{type:Array,default:()=>[]},chipStyle:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(a){return(r,u)=>(i(),V("div",X,[b("div",Y,w(a.label),1),b("div",Z,[a.isEditing&&a.type==="text"?(i(),y(D,{key:0,"model-value":a.modelValue,"onUpdate:modelValue":u[0]||(u[0]=d=>r.$emit("update:modelValue",d)),variant:"outlined",density:"compact","hide-details":"",type:a.inputType},null,8,["model-value","type"])):a.isEditing&&a.type==="textarea"?(i(),y(G,{key:1,"model-value":a.modelValue,"onUpdate:modelValue":u[1]||(u[1]=d=>r.$emit("update:modelValue",d)),variant:"outlined",density:"compact",rows:a.rows||2,"hide-details":""},null,8,["model-value","rows"])):a.isEditing&&a.type==="select"?(i(),y(_,{key:2,"model-value":a.modelValue,"onUpdate:modelValue":u[2]||(u[2]=d=>r.$emit("update:modelValue",d)),items:a.options,variant:"outlined",density:"compact","hide-details":""},null,8,["model-value","items"])):!a.isEditing&&a.chipStyle?(i(),y(z,{key:3,color:"secondary",size:"small",variant:"flat",class:"chip",rounded:"lg"},{default:t(()=>[p(w(a.modelValue),1)]),_:1})):(i(),V("span",ee,w(a.modelValue),1))])]))}},U=A(ae,[["__scopeId","data-v-1cd1f249"]]),le={class:"d-flex align-center"},te={class:"ms-2 pt-4"},se={key:1,class:"d-flex gap-1"},oe={class:"red"},ie={key:0,class:"search-input-wrapper"},ne={key:0,class:"view-list"},ue={key:1,class:"box",style:{background:"aliceblue"}},re={__name:"Index",setup(a){const r=c({}),u=c(!1),d=c({}),h=c([]),g=c([]),$=c(!1),x=c(""),m=c(!1),v=c(""),f=c("error");L(async()=>{const l=await k.get("/api/my/data");r.value=l.data;const e=await k.get("/api/userusers/my/userDown");h.value=e.data.map(n=>n.userName),await J()});const J=async()=>{try{const l=await k.get("/api/userusers/my/userUp");g.value=l.data}catch(l){console.error("載入檢視者清單失敗",l)}},B=async()=>{try{const l=await k.get(`/api/users/check/${x.value.trim()}`),{keyNo:e,userName:n}=l.data;if(g.value.some(C=>C.keyNo===e)){f.value="error",v.value="該檢視者已在名單中",m.value=!0;return}await k.post("/api/userusers/my/userUp",JSON.stringify(e),{headers:{"Content-Type":"application/json"}}),g.value.push({keyNo:e,userName:n}),x.value="",$.value=!1}catch(l){f.value="error",l.response?.status===404?v.value="找不到該使用者":v.value="新增失敗，請稍後再試",m.value=!0}},q=async l=>{try{await k.delete(`/api/userusers/my/${l}`),g.value=g.value.filter(e=>e.keyNo!==l)}catch{f.value="error",v.value="刪除失敗，請稍後再試",m.value=!0}},K=()=>{d.value.email=r.value.email,u.value=!0},M=()=>{u.value=!1,d.value.email=""},O=l=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l),P=async()=>{const l=d.value.email?.trim();if(!l){f.value="error",v.value="請輸入信箱",m.value=!0;return}if(!O(l)){f.value="error",v.value="信箱格式不正確",m.value=!0;return}try{await k.post("/api/users/Email",JSON.stringify(l),{headers:{"Content-Type":"application/json"}}),r.value.email=l,u.value=!1,f.value="success",v.value="信箱更新成功",m.value=!0}catch(e){f.value="error",v.value=e.response?.data?.message||"更新失敗，請稍後再試",m.value=!0}};return(l,e)=>(i(),y(H,{fluid:"",class:"pa-2"},{default:t(()=>[s(j,{justify:"center"},{default:t(()=>[s(S,{cols:"12",md:"10",lg:"9"},{default:t(()=>[s(j,{class:"mb-1"},{default:t(()=>[s(S,{cols:"12",md:"6",class:"pe-md-8"},{default:t(()=>[s(U,{label:"姓名","model-value":o(r).userName},null,8,["model-value"]),s(U,{label:"性別","model-value":o(r).sex},null,8,["model-value"])]),_:1}),s(S,{cols:"12",md:"6",class:"ps-md-8"},{default:t(()=>[b("div",le,[s(U,{label:"信箱","model-value":o(u)?o(d).email:o(r).email,"is-editing":o(u),"input-type":"email","onUpdate:modelValue":e[0]||(e[0]=n=>o(d).email=n)},null,8,["model-value","is-editing"]),b("div",te,[o(u)?(i(),V("div",se,[s(N,{icon:"",size:"small",color:"error",variant:"text",onClick:M},{default:t(()=>[s(E,null,{default:t(()=>[...e[5]||(e[5]=[p("mdi-close",-1)])]),_:1})]),_:1}),s(N,{icon:"",size:"small",color:"success",variant:"text",onClick:P},{default:t(()=>[s(E,null,{default:t(()=>[...e[6]||(e[6]=[p("mdi-content-save",-1)])]),_:1})]),_:1})])):(i(),y(N,{key:0,icon:"",size:"small",color:"primary",variant:"text",onClick:K},{default:t(()=>[s(E,null,{default:t(()=>[...e[4]||(e[4]=[p("mdi-pencil",-1)])]),_:1})]),_:1}))])]),s(U,{label:"單位","model-value":o(r).unitName},null,8,["model-value"])]),_:1})]),_:1}),e[9]||(e[9]=b("label",{class:"view-list"},"檢視者",-1)),b("div",oe,[(i(!0),V(I,null,F(o(g),n=>(i(),y(z,{key:n.keyNo,color:"primary",closable:"",class:"ma-1","onClick:close":C=>q(n.keyNo)},{default:t(()=>[s(E,{start:""},{default:t(()=>[...e[7]||(e[7]=[p("mdi-account",-1)])]),_:1}),p(" "+w(n.userName),1)]),_:2},1032,["onClick:close"]))),128)),o($)?(i(),V("div",ie,[s(D,{modelValue:o(x),"onUpdate:modelValue":e[1]||(e[1]=n=>R(x)?x.value=n:null),density:"compact",variant:"outlined",placeholder:"請輸入完整姓名","hide-details":"",class:"search-input",autofocus:"",onKeyup:Q(B,["enter"])},{"append-inner":t(()=>[s(N,{icon:"mdi-magnify",size:"small",variant:"text",onClick:B})]),_:1},8,["modelValue"])])):(i(),y(N,{key:1,icon:"",size:"small",color:"cyan",variant:"flat",class:"add-btn",onClick:e[2]||(e[2]=n=>$.value=!0)},{default:t(()=>[s(E,null,{default:t(()=>[...e[8]||(e[8]=[p("mdi-plus",-1)])]),_:1})]),_:1}))]),o(h).length>0?(i(),V("label",ne,"可檢視名單")):T("",!0),o(h).length>0?(i(),V("div",ue,[(i(!0),V(I,null,F(o(h),(n,C)=>(i(),y(z,{color:"primary",class:"ma-1",key:C},{default:t(()=>[p(w(n),1)]),_:2},1024))),128))])):T("",!0)]),_:1})]),_:1}),s(W,{modelValue:o(m),"onUpdate:modelValue":e[3]||(e[3]=n=>R(m)?m.value=n:null),timeout:3e3,color:o(f)},{default:t(()=>[p(w(o(v)),1)]),_:1},8,["modelValue","color"])]),_:1}))}},ke=A(re,[["__scopeId","data-v-4d765bde"]]);export{ke as default};

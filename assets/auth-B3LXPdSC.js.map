{"version":3,"file":"auth-B3LXPdSC.js","sources":["../../src/helpers/auth.js"],"sourcesContent":["import { authentication } from \"@/requests\";\r\nimport { useRouter } from 'vue-router'\r\n\r\nexport function auth() {\r\n  let timeout = null;\r\n  const router = useRouter();\r\n\r\n  const signIn = (a) => {\r\n    localStorage.setItem('token', a)\r\n    localStorage.setItem('token.time', new Date())\r\n    // 需求：登入後顯示 /home/index\r\n    router.push('/home/index');\r\n  }\r\n\r\n  const signOut = () => {\r\n    if (timeout) clearTimeout(timeout);\r\n    localStorage.clear();\r\n    router.push('/sign-in')\r\n  }\r\n\r\n  const refreshToken = () => {\r\n    var date = new Date(localStorage.getItem(\"token.time\"));\r\n    if (!date) return;\r\n    timeout = setTimeout(() => {\r\n      authentication.refresh().then(a => {\r\n        localStorage.setItem(\"token\", a.data);\r\n        localStorage.setItem(\"token.time\", new Date());\r\n        refreshToken();\r\n      });\r\n    }, 600000 - (new Date() - date));\r\n  }\r\n\r\n  const switchSystem = (id) => {\r\n    authentication.switch({ id: id }).then(a => {\r\n      localStorage.setItem('token', a.data)\r\n      location.reload();\r\n    })\r\n  }\r\n\r\n  let user = () => {\r\n    var token = localStorage.getItem(\"token\");\r\n    var base64Url = token.split(\".\")[1];\r\n    var base64 = base64Url.replace(/-/g, \"+\").replace(/_/g, \"/\");\r\n    var obj = JSON.parse(window.atob(base64));\r\n    var base64Url = token.split(\".\")[1];\r\n    var base64 = base64Url.replace(/-/g, \"+\").replace(/_/g, \"/\");\r\n    var obj = JSON.parse(\r\n      decodeURIComponent(\r\n        atob(base64)\r\n          .split(\"\")\r\n          .map(function (c) {\r\n            return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\r\n          })\r\n          .join(\"\")\r\n      )\r\n    );\r\n\r\n    return {\r\n      nickname: obj.nickname,\r\n      username: obj[\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"],\r\n      role: obj['http://schemas.microsoft.com/ws/2008/06/identity/claims/role'],\r\n    };\r\n  }\r\n  return {\r\n    signIn,\r\n    signOut,\r\n    refreshToken,\r\n    switchSystem,\r\n    user,\r\n  }\r\n}\r\n"],"names":["auth","timeout","router","useRouter","signIn","a","signOut","refreshToken","date","authentication","id","token","base64Url","base64","obj","c"],"mappings":"0CAGO,SAASA,GAAO,CACrB,IAAIC,EAAU,KACd,MAAMC,EAASC,IAETC,EAAUC,GAAM,CACpB,aAAa,QAAQ,QAASA,CAAC,EAC/B,aAAa,QAAQ,aAAc,IAAI,IAAM,EAE7CH,EAAO,KAAK,aAAa,CAC3B,EAEMI,EAAU,IAAM,CAChBL,GAAS,aAAaA,CAAO,EACjC,aAAa,MAAK,EAClBC,EAAO,KAAK,UAAU,CACxB,EAEMK,EAAe,IAAM,CACzB,IAAIC,EAAO,IAAI,KAAK,aAAa,QAAQ,YAAY,CAAC,EACjDA,IACLP,EAAU,WAAW,IAAM,CACzBQ,EAAe,QAAO,EAAG,KAAKJ,GAAK,CACjC,aAAa,QAAQ,QAASA,EAAE,IAAI,EACpC,aAAa,QAAQ,aAAc,IAAI,IAAM,EAC7CE,GACF,CAAC,CACH,EAAG,KAAU,IAAI,KAASC,EAAK,EACjC,EAiCA,MAAO,CACL,OAAAJ,EACA,QAAAE,EACA,aAAAC,EACA,aAnCoBG,GAAO,CAC3BD,EAAe,OAAO,CAAE,GAAIC,CAAE,CAAE,EAAE,KAAKL,GAAK,CAC1C,aAAa,QAAQ,QAASA,EAAE,IAAI,EACpC,SAAS,OAAM,CACjB,CAAC,CACH,EA+BE,KA7BS,IAAM,CACf,IAAIM,EAAQ,aAAa,QAAQ,OAAO,EACpCC,EAAYD,EAAM,MAAM,GAAG,EAAE,CAAC,EAC9BE,EAASD,EAAU,QAAQ,KAAM,GAAG,EAAE,QAAQ,KAAM,GAAG,EACvDE,EAAM,KAAK,MAAM,OAAO,KAAKD,CAAM,CAAC,EACpCD,EAAYD,EAAM,MAAM,GAAG,EAAE,CAAC,EAC9BE,EAASD,EAAU,QAAQ,KAAM,GAAG,EAAE,QAAQ,KAAM,GAAG,EACvDE,EAAM,KAAK,MACb,mBACE,KAAKD,CAAM,EACR,MAAM,EAAE,EACR,IAAI,SAAUE,EAAG,CAChB,MAAO,KAAO,KAAOA,EAAE,WAAW,CAAC,EAAE,SAAS,EAAE,GAAG,MAAM,EAAE,CAC7D,CAAC,EACA,KAAK,EAAE,CAClB,CACA,EAEI,MAAO,CACL,SAAUD,EAAI,SACd,SAAUA,EAAI,4DAA4D,EAC1E,KAAMA,EAAI,8DAA8D,CAC9E,CACE,CAOF,CACA"}
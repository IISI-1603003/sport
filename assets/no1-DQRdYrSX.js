import{e as oe,i as ee,S as se}from"./index-BS7Z0Srq.js";import{C as m,_ as le}from"./noData-Cmpbj3lj.js";import{R as ne}from"./radarChart-D5zA25RN.js";import{t as ie}from"./tiredContainer-w82VHq1O.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{f,J as q,G as L,M as Z,P,h as ce,aA as de,b as B,o as C,n as fe,d as b,F as te,y as ye,e as y,w as g,m as T,z as J,u as _,p as ve,V as Q,j as he,aD as R,L as $}from"./index-Bz3xUFWk.js";import{V as re,a as U}from"./VRow-CxeqdztZ.js";import"./VSnackbar-Bny0SPdD.js";import"./layout-BMN21tNx.js";import"./VCard-DERAAftr.js";/* empty css              */const pe={class:"box bg-white"},ge={key:0,class:"error-state"},me={class:"error-message"},be={key:1,class:"no-data-container"},we={class:"no-selection-state"},xe={__name:"mixChart",setup(ae){const v=f(null),l=f(null),E=q("responseTired",f([])),N=q("responseBody",f([])),w=q("responseNutrition",f(null)),x=[{key:"體重",label:"體重",source:"body",field:"體重",unit:"kg"},{key:"體脂率",label:"體脂率",source:"body",field:"體脂率",unit:"%"},{key:"肌肉量",label:"肌肉量",source:"body",field:"肌肉量",unit:"kg"},{key:"脂肪重",label:"脂肪重",source:"body",field:"脂肪重",unit:"kg"},{key:"水份比例",label:"水份比例(%)",source:"body",field:"水份比例",unit:"%"},{key:"水份重",label:"水份重(kg)",source:"body",field:"水份重",unit:"kg"},{key:"飲水量",label:"飲水量(ml)",source:"nutrition",field:"飲水量",unit:"ml"},{key:"HB",label:"血紅蛋白(Hb)",source:"tired",field:"hb",unit:""},{key:"CK",label:"肌酸激酶(CK)",source:"tired",field:"ck",unit:""},{key:"BUN",label:"血中素氮(BUN)",source:"tired",field:"bun",unit:""}],n=f(["體重"]),D=e=>{const r=n.value.indexOf(e);r>-1?n.value.splice(r,1):n.value.length<2&&n.value.push(e)},j=e=>n.value.includes(e)?"primary":"default",z=e=>{try{let r=[],a=[];switch(e.source){case"body":if(r=N.value,!r||!Array.isArray(r))return console.warn(`身體數據不可用 (${e.key})`),[];a=r.filter(t=>t&&typeof t=="object").map(t=>{try{return{date:t.date,value:t[e.field]}}catch(i){return console.warn("處理身體數據項目失敗:",i),null}}).filter(t=>t&&t.date&&t.value!==null&&t.value!==void 0&&!isNaN(parseFloat(t.value)));break;case"tired":if(r=E.value,!r||!Array.isArray(r))return console.warn(`疲勞數據不可用 (${e.key})`),[];a=r.filter(t=>t&&typeof t=="object").map(t=>{try{return{date:t.date,value:t[e.field]}}catch(i){return console.warn("處理疲勞數據項目失敗:",i),null}}).filter(t=>t&&t.date&&t.value!==null&&t.value!==void 0&&!isNaN(parseFloat(t.value)));break;case"nutrition":if(r=w?.value.datas,!r||!Array.isArray(r))return console.warn(`營養數據不可用 (${e.key})`),[];a=r.filter(t=>t&&typeof t=="object").map(t=>{try{return{date:t.date,value:t[e.field]}}catch(i){return console.warn("處理營養數據項目失敗:",i),null}}).filter(t=>t&&t.date&&t.value!==null&&t.value!==void 0&&!isNaN(parseFloat(t.value)));break;default:return console.error(`未知的數據來源: ${e.source}`),[]}return a}catch(r){return console.error(`獲取指標數據失敗 (${e.key}):`,r),n.value.includes(e.key)&&u(`指標 "${e.label}" 數據處理失敗`),[]}},G=(e,r)=>{try{if(!e||!Array.isArray(e)||e.length===0)return console.warn("第一個數據集無效或為空"),{dates:[],values1:[],values2:[]};if(!r||!Array.isArray(r)||r.length===0)return console.warn("第二個數據集無效或為空"),{dates:[],values1:[],values2:[]};const a=new Set,t=new Set;e.forEach(s=>{s&&s.date&&a.add(s.date)}),r.forEach(s=>{s&&s.date&&t.add(s.date)});const i=[...a].filter(s=>t.has(s)).sort();if(i.length===0)return console.warn("兩個數據集沒有共同的日期"),u("所選指標沒有共同的日期數據"),{dates:[],values1:[],values2:[]};const h=new Map,c=new Map;e.forEach(s=>{s&&s.date&&s.value!==null&&s.value!==void 0&&h.set(s.date,parseFloat(s.value))}),r.forEach(s=>{s&&s.date&&s.value!==null&&s.value!==void 0&&c.set(s.date,parseFloat(s.value))});const p=[],M=[],F=[];return i.forEach(s=>{const W=h.get(s),X=c.get(s);W!==void 0&&X!==void 0&&!isNaN(W)&&!isNaN(X)&&(p.push(s),M.push(W),F.push(X))}),{dates:p,values1:M,values2:F}}catch(a){return console.error("日期對齊處理失敗:",a),{dates:[],values1:[],values2:[]}}},I=e=>{try{return!e||!Array.isArray(e)||e.length===0?!1:e.every(r=>r&&typeof r=="object"&&r.date&&r.value!==null&&r.value!==void 0&&!isNaN(r.value))}catch(r){return console.error("數據驗證失敗:",r),!1}},O=L(()=>{try{return n.value.length===0?!1:n.value.map(a=>{const t=x.find(c=>c.key===a);if(!t)return console.warn(`找不到指標配置: ${a}`),!1;const i=z(t);return I(i)}).every(a=>a)}catch(e){return console.error("數據有效性檢查失敗:",e),!1}}),H=L(()=>A.value.hasError?!1:n.value.length===0||n.value.length>0&&!O.value),k=L(()=>{try{if(!O.value||n.value.length===0)return null;if(n.value.length===1){const e=n.value[0],r=x.find(t=>t.key===e);if(!r)return console.error(`找不到指標配置: ${e}`),null;const a=z(r);return I(a)?{mode:"single",indicator:r,dates:a.map(t=>t.date),values:a.map(t=>parseFloat(t.value)),dataCount:a.length}:(console.error(`指標 ${e} 的數據處理後仍無效`),null)}else if(n.value.length===2){const e=n.value[0],r=n.value[1],a=x.find(p=>p.key===e),t=x.find(p=>p.key===r);if(!a||!t)return console.error("找不到指標配置"),null;const i=z(a),h=z(t);if(!I(i)||!I(h))return console.error("雙軸模式中有無效數據"),null;const c=G(i,h);return!c.dates||c.dates.length===0?(console.warn("沒有共同的日期數據"),null):{mode:"dual",indicator1:a,indicator2:t,dates:c.dates,values1:c.values1.map(p=>parseFloat(p)),values2:c.values2.map(p=>parseFloat(p)),dataCount:c.dates.length,originalCount1:i.length,originalCount2:h.length}}return null}catch(e){return console.error("圖表數據處理失敗:",e),null}}),K=e=>{const{indicator1:r,indicator2:a,dates:t,values1:i,values2:h}=e;return{color:m,tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}},formatter:c=>{let p=`${c[0].axisValue}<br/>`;return c.forEach((M,F)=>{const s=F===0?r:a;p+=`${M.seriesName}: ${M.value} ${s.unit||""}<br/>`}),p}},legend:{data:[r.label,a.label],top:"top",left:"center"},grid:{left:"8%",right:"8%",bottom:"30%",containLabel:!1},xAxis:{type:"category",data:t,axisLabel:{rotate:45,fontSize:10}},yAxis:[{type:"value",name:`${r.label} (${r.unit||""})`,nameLocation:"middle",nameGap:35,position:"left",nameTextStyle:{fontSize:12,color:"#555"},axisLine:{lineStyle:{color:m[0]}},axisLabel:{color:"#555"}},{type:"value",name:`${a.label} (${a.unit||""})`,nameLocation:"middle",nameGap:35,position:"right",nameTextStyle:{fontSize:12,color:"#555"},axisLine:{lineStyle:{color:m[1]}},axisLabel:{color:"#555"}}],series:[{name:r.label,type:"line",yAxisIndex:0,data:i,itemStyle:{color:m[0]},lineStyle:{color:m[0],width:2},label:{show:!0,position:"top",fontSize:10,color:m[0],formatter:c=>c.value},symbol:"circle",symbolSize:6,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}},{name:a.label,type:"line",yAxisIndex:1,data:h,itemStyle:{color:m[1]},lineStyle:{color:m[1],width:2},label:{show:!0,position:"top",fontSize:10,color:m[1],formatter:c=>c.value},symbol:"triangle",symbolSize:6,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}],dataZoom:[{type:"slider",start:0,end:100,height:20,bottom:10,xAxisIndex:[0],brushSelect:!1},{type:"inside",start:0,end:100,xAxisIndex:[0],zoomOnMouseWheel:!0,moveOnMouseMove:!0}]}},d=e=>{const{indicator:r,dates:a,values:t}=e;return{color:m,tooltip:{trigger:"axis",formatter:i=>{const h=i[0];return`${h.axisValue}<br/>
                ${h.seriesName}: ${h.value} ${r.unit||""}`}},legend:{data:[r.label],top:"top",left:"center"},grid:{left:"8%",right:"8%",bottom:"30%",containLabel:!1},xAxis:{type:"category",data:a,axisLabel:{rotate:45,fontSize:10}},yAxis:{type:"value",name:`${r.label} (${r.unit||""})`,nameLocation:"middle",nameGap:35,nameTextStyle:{fontSize:12}},series:[{name:r.label,type:"line",data:t,itemStyle:{color:m[0]},lineStyle:{color:m[0],width:2},label:{show:!0,position:"top",fontSize:10,formatter:i=>i.value},symbol:"circle",symbolSize:6,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}],dataZoom:[{type:"slider",start:0,end:100,height:20,bottom:10,xAxisIndex:[0],brushSelect:!1},{type:"inside",start:0,end:100,xAxisIndex:[0],zoomOnMouseWheel:!0,moveOnMouseMove:!0}]}},o=()=>{try{if(!l.value){u("圖表實例未初始化，請嘗試重新載入頁面");return}if(!k.value){try{l.value.clear()}catch(r){console.warn("清空圖表失敗:",r)}return}let e=null;if(k.value.mode==="single")try{e=d(k.value)}catch(r){u(`單軸圖表配置生成失敗: ${r.message}`);return}else if(k.value.mode==="dual")try{e=K(k.value)}catch(r){u(`雙軸圖表配置生成失敗: ${r.message}`);return}else{u(`未知的圖表模式: ${k.value.mode}`);return}if(e){if(!e.series||!Array.isArray(e.series)||e.series.length===0){u("圖表配置無效：缺少系列數據");return}if(!e.series.every(a=>a&&a.data&&Array.isArray(a.data)&&a.data.length>0)){u("圖表數據無效：系列數據為空或格式錯誤");return}try{l.value.setOption(e,{notMerge:!0,lazyUpdate:!1,silent:!1}),setTimeout(()=>{l.value&&l.value.resize()},100),V()}catch(a){u(`圖表選項設置失敗: ${a.message}`)}}else u("無法生成圖表配置，請檢查數據格式")}catch(e){u(`圖表渲染過程發生未預期錯誤: ${e.message}`)}},S=()=>{if(!v.value){console.warn("圖表容器未找到"),u("圖表容器初始化失敗，請重新載入頁面");return}try{if(l.value){try{l.value.dispose()}catch(e){console.warn("銷毀舊圖表實例失敗:",e)}l.value=null}if(!oe||typeof ee!="function"){u("ECharts 庫未正確載入，請重新載入頁面");return}l.value=ee(v.value),l.value.on("error",e=>{console.error("ECharts 運行時錯誤:",e),u("圖表渲染過程中發生錯誤")}),V()}catch(e){console.error("ECharts 初始化失敗:",e),u(`圖表初始化失敗: ${e.message}`)}},A=f({hasError:!1,errorMessage:""}),u=e=>{A.value={hasError:!0,errorMessage:e},console.error(`圖表錯誤 : ${e}`)},V=()=>{A.value={hasError:!1,errorMessage:""}};Z(k,(e,r)=>{try{V(),e&&l.value?P(()=>{o()}):!e&&r&&l.value&&l.value.clear()}catch(a){u(`數據變化處理失敗: ${a.message}`)}},{deep:!0}),Z(n,(e,r)=>{try{V(),l.value&&P(()=>{e.length===0?l.value.clear():o()})}catch(a){u(`指標選擇處理失敗: ${a.message}`)}},{deep:!0}),Z([()=>N,()=>E,()=>w],(e,r)=>{try{V(),P(()=>{!l.value&&v.value&&S(),n.value.length>0&&l.value&&o()})}catch(a){u(`原始數據變化處理失敗: ${a.message}`)}},{deep:!0,immediate:!0});const Y=()=>{l.value&&l.value.resize()};return ce(()=>{P(()=>{v.value?(S(),k.value&&o(),window.addEventListener("resize",Y)):console.error("圖表容器未找到")})}),de(()=>{if(window.removeEventListener("resize",Y),l.value)try{l.value.dispose(),l.value=null}catch(e){console.error("ECharts 實例銷毀失敗:",e)}}),(e,r)=>(C(),B("div",pe,[(C(),B(te,null,ye(x,a=>y(ve,{key:a.key,color:j(a.key),variant:_(n).includes(a.key)?"flat":"outlined",onClick:t=>D(a.key),class:"ma-1",size:"small"},{default:g(()=>[T(J(a.label),1)]),_:2},1032,["color","variant","onClick"])),64)),_(A).hasError?(C(),B("div",ge,[y(Q,{color:"error",class:"mb-2",size:"48"},{default:g(()=>[...r[0]||(r[0]=[T("mdi-alert-circle",-1)])]),_:1}),r[1]||(r[1]=b("div",{class:"error-title"},"發生錯誤",-1)),b("div",me,J(_(A).errorMessage),1)])):_(H)?(C(),B("div",be,[b("div",we,[y(Q,{class:"mb-3",color:"primary",size:"48"},{default:g(()=>[...r[2]||(r[2]=[T("mdi-database-off",-1)])]),_:1}),b("div",null,J(_(n).length===0?"請從上方選擇 1-2 個指標來顯示趨勢圖表":"所選指標沒有可用數據"),1)])])):fe("",!0),b("div",{ref_key:"chartContainer",ref:v,class:"chart-container"},null,512)]))}},ke=ue(xe,[["__scopeId","data-v-d439ec33"]]),Se={key:0,class:"pa-4"},$e={class:"box bg-white"},_e={class:"box bg-white"},Ae={class:"box bg-white"},Oe={__name:"no1",setup(ae){const v=f("user123"),l=f([]),E=f(!1),N=f(null);f("");const w=f([]),x=f([]),n=f([]),D=f(null),j=L(()=>w?.value?.length>0),z=L(()=>w.value.length===0?{}:[...w.value].sort((o,S)=>new Date(S.date)-new Date(o.date))[0]||{}),G=async d=>{try{const o=await R.getPsychologyIndicator(v.value,d);o.data?(w.value=o.data,l.value=w.value.map(S=>S.date).sort((S,A)=>new Date(A)-new Date(S))):(console.error("心理API 回傳資料格式錯誤:",o),w.value=[])}catch(o){console.error("fetchresponsePsychology失敗:",o),w.value=[]}},I=async d=>{try{const o=await R.getPhysiologyIndicatorTired(v.value,d);x.value=o.data||[]}catch(o){console.error("fetchresponseTired失敗:",o),x.value=[]}},O=async d=>{try{const o=await R.getPhysiologyIndicatorBody(v.value,d);n.value=o.data||[]}catch(o){console.error("fetchresponseBody失敗:",o),n.value=[]}},H=async d=>{try{const o=await R.getNutritionIndicatorWater(v.value,d);D.value=o.data}catch(o){console.error("fetchresponseNutrition失敗:",o),D.value=null}},k=async d=>{E.value=!0,N.value=null;try{const o=d?.queryString||"",S=d?.selectedUserId||v.value;v.value=S,await Promise.all([G(o),O(o),I(o),H(o)])}catch(o){N.value="數據載入失敗，請稍後重試",console.error("數據載入錯誤:",o)}finally{E.value=!1}},K=async d=>{await k(d)};return $("latestDatas",z),$("allDates",l),$("responsePsychology",w),$("responseTired",x),$("responseBody",n),$("responseNutrition",D),$("loading",E),$("error",N),$("selectedUserId",v),(d,o)=>(C(),B(te,null,[y(se,{onSearch:K},{icon:g(()=>[y(Q,null,{default:g(()=>[...o[0]||(o[0]=[T("mdi-heart-pulse",-1)])]),_:1})]),title:g(()=>[...o[1]||(o[1]=[T(" 綜合監控 ",-1)])]),dashboardTypes:g(()=>[...o[2]||(o[2]=[b("select",{class:"select"},[b("option",null,"疲勞監控與身體組成分析")],-1)])]),_:1}),_(j)?(C(),B("section",Se,[y(re,null,{default:g(()=>[y(U,{cols:"6"},{default:g(()=>[b("div",$e,[y(ne)])]),_:1}),y(U,{cols:"6"},{default:g(()=>[b("div",_e,[o[3]||(o[3]=b("h2",null,"疲勞監控",-1)),y(ie)])]),_:1})]),_:1}),y(re,null,{default:g(()=>[y(U,{cols:"6"},{default:g(()=>[b("div",Ae,[y(ke,{"response-tired":_(x),"response-body":_(n),"response-nutrition":_(D)},null,8,["response-tired","response-body","response-nutrition"])])]),_:1}),y(U,{cols:"6"},{default:g(()=>[...o[4]||(o[4]=[b("div",{class:"box bg-white"},null,-1)])]),_:1})]),_:1})])):(C(),he(le,{key:1}))],64))}};export{Oe as default};
//# sourceMappingURL=no1-DQRdYrSX.js.map

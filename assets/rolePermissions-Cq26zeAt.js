import{P as M,Q as q,R as H,S as Q,d as u,T as W,U as X,W as Y,X as A,Y as F,b as s,C as I,Z,_ as G,$ as J,a0 as K,a1 as ee,E as te,L as ae,e as le,c as b,w as i,F as P,p as se,o as p,B as ie,m as w,k as $,a as k,q as oe,t as L,l as ne,j as de,h as re,a2 as me,a3 as ue}from"./index-Dfwmr34z.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as S,a as j}from"./VRow-BxR3TJ0q.js";import{V as pe}from"./VDialog-CKkDjSOJ.js";import{V as z,a as fe,b as N,c as ve}from"./VCard-BqK8UscN.js";import{V as he}from"./VSpacer-C8PYAQhS.js";/* empty css              */const Ve=q({...J(),...G(K(),["inline"])},"VCheckbox"),D=M()({name:"VCheckbox",inheritAttrs:!1,props:Ve(),emits:{"update:modelValue":d=>!0,"update:focused":d=>!0},setup(d,c){let{attrs:f,slots:o}=c;const r=H(d,"modelValue"),{isFocused:v,focus:m,blur:l}=Q(d),g=u(),C=W();return X(()=>{const[_,E]=Y(f),R=A.filterProps(d),h=F.filterProps(d);return s(A,I({ref:g,class:["v-checkbox",d.class]},_,R,{modelValue:r.value,"onUpdate:modelValue":V=>r.value=V,id:d.id||`checkbox-${C}`,focused:v.value,style:d.style}),{...o,default:V=>{let{id:y,messagesId:U,isDisabled:B,isReadonly:T,isValid:t}=V;return s(F,I(h,{id:y.value,"aria-describedby":U.value,disabled:B.value,readonly:T.value},E,{error:t.value===!1,modelValue:r.value,"onUpdate:modelValue":e=>r.value=e,onFocus:m,onBlur:l}),o)}})}),Z({},g)}}),be={class:"d-flex align-center"},ke={class:"permissions-tree"},Ce={key:0,class:"permission-category"},ye={class:"ms-8"},xe={__name:"rolePermissions",setup(d){se();const c=u(!1),f=u(!1),o=u(""),r=u(""),v=u([{id:"admin",name:"系統管理員"},{id:"coach",name:"教練"},{id:"analyst",name:"數據分析師"},{id:"doctor",name:"醫療人員"},{id:"athlete",name:"選手"}]),m=u([{id:"physiological",name:"生理監控",nameEn:"Physiological",items:[{id:"template1",name:"選手生理監測儀表板"},{id:"template2",name:"生理狀態綜合儀表板"},{id:"template3",name:"運動生理數據總覽"}]},{id:"psychological",name:"心理監控",nameEn:"Psychological",items:[{id:"template1",name:"心理健康與壓力監控儀表板"},{id:"template2",name:"選手心理狀態追蹤儀表板"},{id:"template3",name:"心理與恢復趨勢總覽"}]},{id:"nutrition",name:"營養監控",nameEn:"Nutrition / Hydration",items:[{id:"template1",name:"水分補給與代謝監控儀表板"},{id:"template2",name:"營養補給行為分析儀表板"},{id:"template3",name:"飲水與汗液電解平衡儀表板"}]},{id:"performance",name:"體能監控",nameEn:"Performance",items:[{id:"template1",name:"體能表現與爆發力分析儀表板"},{id:"template2",name:"跳躍能力與肌肉性分析儀表板"}]}]),l=ee({});(()=>{m.value.forEach(t=>{l[t.id]={selected:!1,indeterminate:!1,expanded:!0,items:{}},t.items.forEach(e=>{l[t.id].items[e.id]=!1})})})(),te(()=>!!o.value);const C=async t=>{if(t){c.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),_(t)}catch(e){console.error("載入權限失敗:",e)}finally{c.value=!1}}},_=t=>{switch(y(),t){case"admin":E(!0);break;case"coach":l.physiological.items.template1=!0,l.psychological.items.template1=!0,l.nutrition.items.template1=!0,l.performance.items.template1=!0;break;case"analyst":l.physiological.items.template2=!0,l.psychological.items.template3=!0,l.nutrition.items.template2=!0,l.performance.items.template2=!0;break;case"doctor":l.physiological.items.template1=!0,l.physiological.items.template2=!0,l.psychological.items.template1=!0;break;case"athlete":l.physiological.items.template1=!0,l.psychological.items.template2=!0;break}V()},E=t=>{m.value.forEach(e=>{e.items.forEach(a=>{l[e.id].items[a.id]=t}),l[e.id].selected=t,l[e.id].indeterminate=!1})},R=t=>{const e=l[t],a=e.selected;Object.keys(e.items).forEach(n=>{e.items[n]=a}),h(t)},h=t=>{const e=l[t],a=Object.values(e.items),n=a.filter(O=>O).length,x=a.length;n===0?(e.selected=!1,e.indeterminate=!1):n===x?(e.selected=!0,e.indeterminate=!1):(e.selected=!1,e.indeterminate=!0)},V=()=>{m.value.forEach(t=>{h(t.id)})},y=()=>{m.value.forEach(t=>{l[t.id].selected=!1,l[t.id].indeterminate=!1,t.items.forEach(e=>{l[t.id].items[e.id]=!1})})},U=async()=>{if(!o.value){alert("請先選擇角色");return}f.value=!0;try{const t={};m.value.forEach(e=>{t[e.id]=[],e.items.forEach(a=>{l[e.id].items[a.id]&&t[e.id].push(a.id)})}),await new Promise(e=>setTimeout(e,1500)),console.log("儲存權限設定:",{roleId:o.value,permissions:t}),alert("權限設定已儲存")}catch(t){console.error("儲存權限失敗:",t),alert("儲存失敗，請重試")}finally{f.value=!1}},B=async()=>{if(!o.value){alert("請先選擇角色");return}try{const t=new Blob(["權限清查表內容"],{type:"application/zip"}),e=window.URL.createObjectURL(t),a=document.createElement("a");a.href=e,a.download=`權限清查表_${o.value}_${new Date().getTime()}.zip`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(e)}catch(t){console.error("下載失敗:",t),alert("下載失敗，請重試")}},T=()=>{r.value.trim()&&console.log("搜尋權限:",r.value)};return ae(r,t=>{t||m.value.forEach(e=>{l[e.id].expanded=!0})}),le(()=>{v.value.length>0&&(o.value=v.value[0].id,C(o.value))}),(t,e)=>(p(),b(P,null,[s(S,null,{default:i(()=>[s(j,{cols:"12",md:"4"},{default:i(()=>[s(ie,{modelValue:o.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>o.value=a),C],items:v.value,"item-title":"name","item-value":"id",label:"選擇角色",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),s(j,{cols:"12",md:"8",class:"d-flex justify-end"},{default:i(()=>[s(w,{color:"primary","prepend-icon":"mdi-download",onClick:B},{default:i(()=>[...e[3]||(e[3]=[$(" 下載權限清查表 ",-1)])]),_:1})]),_:1})]),_:1}),s(S,null,{default:i(()=>[s(j,{cols:"12"},{default:i(()=>[s(z,{class:"permission-card"},{default:i(()=>[s(fe,{class:"d-flex justify-space-between align-center"},{default:i(()=>[e[4]||(e[4]=k("span",null,"儀表板",-1)),k("div",be,[s(oe,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value=a),"prepend-inner-icon":"mdi-magnify",placeholder:"搜尋",variant:"outlined",density:"compact",width:"300","hide-details":"",clearable:"",class:"me-2"},null,8,["modelValue"]),s(w,{color:"primary",onClick:T,text:"尋找"})])]),_:1}),s(N,null,{default:i(()=>[k("div",ke,[(p(!0),b(P,null,L(m.value,a=>(p(),b(P,{key:a.id},[l[a.id]?(p(),b("div",Ce,[s(D,{modelValue:l[a.id].selected,"onUpdate:modelValue":n=>l[a.id].selected=n,indeterminate:l[a.id].indeterminate,"hide-details":"",label:`${a.name} (${a.nameEn})`,color:"teal",class:"category-checkbox",onChange:n=>R(a.id)},null,8,["modelValue","onUpdate:modelValue","indeterminate","label","onChange"]),de(k("div",ye,[(p(!0),b(P,null,L(a.items,n=>(p(),re(D,{key:n.id,modelValue:l[a.id].items[n.id],"onUpdate:modelValue":x=>l[a.id].items[n.id]=x,label:n.name,"hide-details":"",color:"teal",class:"subcategory-checkbox",onChange:x=>h(a.id)},null,8,["modelValue","onUpdate:modelValue","label","onChange"]))),128))],512),[[me,l[a.id].expanded]])])):ne("",!0)],64))),128))])]),_:1}),s(ve,{class:"pa-4"},{default:i(()=>[s(he),s(w,{color:"grey",variant:"outlined",onClick:y},{default:i(()=>[...e[5]||(e[5]=[$(" 重置 ",-1)])]),_:1}),s(w,{color:"primary",onClick:U,loading:f.value},{default:i(()=>[...e[6]||(e[6]=[$(" 儲存設定 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),s(pe,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=a=>c.value=a),persistent:"",width:"300"},{default:i(()=>[s(z,null,{default:i(()=>[s(N,{class:"text-center pa-6"},{default:i(()=>[s(ue,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),e[7]||(e[7]=k("div",null,"載入中...",-1))]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Be=ce(xe,[["__scopeId","data-v-8e2a4710"]]);export{Be as default};

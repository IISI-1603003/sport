import{R as ReCaptchaVuePluginExports,f as ref,h as onMounted,s as useRouter,i as authentication,j as createBlock,w as withCtx,q as isRef,u as unref,k as withModifiers,r as resolveComponent,o as openBlock,d as createBaseVNode,e as createVNode,z as toDisplayString,t as VTextField,V as VIcon,m as createTextVNode,p as VBtn}from"./index-D5t5jYde.js";import{p as pwRule,a as pwConfirmRule,c as codeRule}from"./rules-Bm4BX98a.js";import{_ as _export_sfc}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as VForm}from"./VForm-DZV4Qkzz.js";const _hoisted_1={class:"text-center mt-5"},_hoisted_2={style:{"white-space":"nowrap"}},_sfc_main={__name:"forgetSet",setup(__props){const router=useRouter(),{executeRecaptcha}=ReCaptchaVuePluginExports.useReCaptcha(),loading=ref(!1),valid=ref(!0),showPw=ref(!1),showConfirmPw=ref(!1),form=ref({email:"",pw:"",pwConfirm:"",code:""});onMounted(()=>{form.value.email=router.currentRoute.value.query.email,reSend()});function letPwVisible(){showPw.value=!showPw.value}function letConfirmPwVisible(){showConfirmPw.value=!showConfirmPw.value}const submit=async()=>{const rules=[pwRule,codeRule];for(const rule of rules){const result=rule(form.value[Object.keys(form.value).find(key=>rule===eval(key+"Rule"))]);if(result!==!0){alert(result);return}}const pwConfirmResult=pwConfirmRule(form.value.pw,form.value.pwConfirm);if(pwConfirmResult!==!0){alert(result);return}loading.value=!0,authentication.forgetPwByEmail({email:form.value.email,newPw:form.value.pw,verifyCode:form.value.code}).then(()=>{alert("密碼修改成功，請使用新密碼登入"),router.push("/sign-in/forgetSetSuccess")}).catch(o=>{alert(o.response.data||"系統異常，請稍後再試。")}).finally(()=>{loading.value=!1})},countdown=ref(0);let countdownInterval=null;function startCountdown(){countdown.value>0||(countdown.value=60,countdownInterval=setInterval(()=>{countdown.value>0?countdown.value--:clearInterval(countdownInterval)},1e3))}function reSend(){loading.value=!0,authentication.forgetPwVerifyCode(form.value.email).then(()=>{alert("已寄送驗證碼，如未收到請檢查垃圾信件匣"),startCountdown()}).catch(o=>{alert(o.response.data||"系統異常，請稍後再試。")}).finally(()=>{loading.value=!1})}return(o,e)=>{const r=resolveComponent("router-link");return openBlock(),createBlock(VForm,{onSubmit:withModifiers(submit,["prevent"]),modelValue:unref(valid),"onUpdate:modelValue":e[3]||(e[3]=t=>isRef(valid)?valid.value=t:null),class:"mx-auto register-form"},{default:withCtx(()=>[e[10]||(e[10]=createBaseVNode("h2",{class:"text-center"},"修改密碼",-1)),createBaseVNode("p",_hoisted_1,"已將驗證碼寄送至"+toDisplayString(unref(form).email),1),e[11]||(e[11]=createBaseVNode("p",null,"請輸入驗證碼，修改密碼。",-1)),createVNode(VTextField,{"hide-details":"auto",modelValue:unref(form).pw,"onUpdate:modelValue":e[0]||(e[0]=t=>unref(form).pw=t),type:unref(showPw)?"text":"password",density:"compact",label:"密碼","prepend-inner-icon":"mdi-lock",variant:"solo",required:"",class:"register-item mb-2",rules:[unref(pwRule)]},{label:withCtx(()=>[...e[4]||(e[4]=[createBaseVNode("span",{class:"text-danger"},"*",-1),createTextVNode("密碼 ",-1)])]),"append-inner":withCtx(()=>[createVNode(VIcon,{onClick:letPwVisible,class:"cursor-pointer"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(showPw)?"mdi-eye":"mdi-eye-off"),1)]),_:1})]),_:1},8,["modelValue","type","rules"]),createVNode(VTextField,{"hide-details":"auto",modelValue:unref(form).pwConfirm,"onUpdate:modelValue":e[1]||(e[1]=t=>unref(form).pwConfirm=t),type:unref(showConfirmPw)?"text":"password",density:"compact",label:"確認密碼","prepend-inner-icon":"mdi-lock-check",variant:"solo",required:"",rules:[t=>unref(pwConfirmRule)(unref(form).pw,t)],class:"register-item mb-2"},{label:withCtx(()=>[...e[5]||(e[5]=[createBaseVNode("span",{class:"text-danger"},"*",-1),createTextVNode("確認密碼 ",-1)])]),"append-inner":withCtx(()=>[createVNode(VIcon,{onClick:letConfirmPwVisible,class:"cursor-pointer"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(showConfirmPw)?"mdi-eye":"mdi-eye-off"),1)]),_:1})]),_:1},8,["modelValue","type","rules"]),createVNode(VTextField,{"hide-details":"auto",modelValue:unref(form).code,"onUpdate:modelValue":e[2]||(e[2]=t=>unref(form).code=t),density:"compact",label:"驗證碼","prepend-inner-icon":"mdi-lock-check",variant:"solo",required:"",rules:[unref(codeRule)],class:"register-item mb-2"},{label:withCtx(()=>[...e[6]||(e[6]=[createBaseVNode("span",{class:"text-danger"},"*",-1),createTextVNode("驗證碼 ",-1)])]),"append-inner":withCtx(()=>[unref(countdown)>0?(openBlock(),createBlock(VBtn,{key:0,variant:"tonal",color:"primary",size:"small"},{default:withCtx(()=>[createBaseVNode("p",_hoisted_2,toDisplayString(unref(countdown))+"秒 重新發送",1)]),_:1})):(openBlock(),createBlock(VBtn,{key:1,onClick:reSend,variant:"flat",color:"primary",size:"small"},{default:withCtx(()=>[...e[7]||(e[7]=[createBaseVNode("p",{style:{"white-space":"nowrap",color:"white !important"}},"重新發送",-1)])]),_:1}))]),_:1},8,["modelValue","rules"]),createVNode(VBtn,{type:"submit",variant:"flat",color:"primary",block:"",class:"mt-5",loading:unref(loading)},{default:withCtx(()=>[...e[8]||(e[8]=[createTextVNode(" 確認 ",-1)])]),_:1},8,["loading"]),e[12]||(e[12]=createBaseVNode("div",{class:"or"},"或",-1)),createVNode(r,{to:"/sign-in",class:"text-decoration-none"},{default:withCtx(()=>[...e[9]||(e[9]=[createTextVNode(" 回登入 ",-1)])]),_:1})]),_:1},8,["modelValue"])}}},forgetSet=_export_sfc(_sfc_main,[["__scopeId","data-v-949d2ead"]]);export{forgetSet as default};

import{d as i,e as S,p as E,s as x,h as c,w as l,n as I,u as s,i as R,r as M,o as u,a as n,c as _,b as v,F as z,t as D,k as d,x as f,q as L,m as g}from"./index-Dfwmr34z.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as U}from"./VForm-Dq5Ksm3-.js";const $={class:"label-item"},j={class:"label-item"},A={style:{"white-space":"nowrap"}},G={__name:"registerStep1",setup(H){const y=E(),V=i(!1),p=i(!0),t=i({userName:"",name:"",email:"",code:""}),m=i({userName:"",name:"",email:""}),q={userName:"帳號/員工編號",name:"姓名",email:"信箱"};S(()=>{const a=y.currentRoute.value.query;m.value.userName=a.userName||"",m.value.name=a.name||"",m.value.email=a.email||"",t.value.userName=a.userName||"",t.value.name=a.name||"",t.value.email=a.email||"",N(),k(a.email)});const C=a=>q[a]||a,r=i(0);let b=null;function N(){r.value>0||(r.value=60,b=setInterval(()=>{r.value>0?r.value--:clearInterval(b)},1e3))}function k(a){x.getEmailVarifyCode(a).then(()=>{N()})}const B=async()=>{x.getEmployeeFromDM(t.value.userName,t.value.email,t.value.code).then(a=>{a.status===200?(V.value=!0,y.push({path:"/sign-in/registerStep2",query:{email:t.value.email,name:t.value.name,userName:t.value.userName,gender:a.data.sex_name,unit:a.data.unit_name}})):alert("驗證碼錯誤，請重新輸入。")}).catch(()=>{alert("系統異常，請重新操作。")})};return(a,e)=>{const F=M("router-link");return u(),c(U,{onSubmit:R(B,["prevent"]),modelValue:s(p),"onUpdate:modelValue":e[2]||(e[2]=o=>I(p)?p.value=o:null),class:"mx-auto register-form"},{default:l(()=>[e[8]||(e[8]=n("h2",{class:"text-center mb-3"},"一般帳號註冊",-1)),(u(!0),_(z,null,D(s(m),(o,w)=>(u(),_("div",{key:w,class:"label-container text-start mt-3"},[n("span",$,f(C(w)),1),e[3]||(e[3]=d()),n("span",j,f(o),1)]))),128)),v(L,{"hide-details":"auto",modelValue:s(t).code,"onUpdate:modelValue":e[1]||(e[1]=o=>s(t).code=o),density:"compact",label:"驗證碼","prepend-inner-icon":"mdi-lock-check",variant:"solo",required:"",rules:[a.codeRule],class:"register-item mb-2"},{label:l(()=>[...e[4]||(e[4]=[n("span",{class:"text-danger"},"*",-1),d("驗證碼 ",-1)])]),"append-inner":l(()=>[s(r)>0?(u(),c(g,{key:0,variant:"tonal",color:"primary",size:"small"},{default:l(()=>[n("p",A,f(s(r))+"秒 重新發送",1)]),_:1})):(u(),c(g,{key:1,onClick:e[0]||(e[0]=o=>k(a.query.email)),variant:"flat",color:"primary",size:"small"},{default:l(()=>[...e[5]||(e[5]=[n("p",{style:{"white-space":"nowrap",color:"white !important"}},"重新發送",-1)])]),_:1}))]),_:1},8,["modelValue","rules"]),v(g,{type:"submit",variant:"flat",color:"primary",block:"",class:"mt-5",loading:s(V)},{default:l(()=>[...e[6]||(e[6]=[d(" 驗證 ",-1)])]),_:1},8,["loading"]),e[9]||(e[9]=n("div",{class:"or"},"或",-1)),v(F,{to:"/sign-in",class:"text-decoration-none"},{default:l(()=>[...e[7]||(e[7]=[d("回登入",-1)])]),_:1})]),_:1},8,["modelValue"])}}},P=T(G,[["__scopeId","data-v-cffd6ac0"]]);export{P as default};

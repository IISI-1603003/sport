import{f as d,H as A,z as D,E as F,h as H,j as x,w as s,p as I,o as m,e as i,m as y,d as u,b as h,F as w,s as E,x as M,l as q,I as G}from"./index-Ccv3H6vA.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Q}from"./VContainer-B5pCGxWI.js";import{V as P,a as k}from"./VRow-DJBRX9vE.js";import{V as W}from"./VSelect-CdRTkrqL.js";import{V as v,b as X}from"./VBtn-BFa_qlL5.js";import{V as U,a as Y,b as R,c as Z}from"./VCard-CyCgHi5B.js";import{V as K}from"./VTextField-BPGlyt2x.js";import{V as T}from"./VCheckbox-CMz3wDcJ.js";import{V as ee}from"./VSpacer-ocidunb_.js";import{V as te}from"./VDialog-C8AopR3c.js";/* empty css              */import"./index-BY3Wz3HY.js";import"./forwardRefs-DvCcwqpd.js";import"./VList-C1jYE1zF.js";import"./index-CuhzYj1f.js";import"./VAvatar-B8Hptg_2.js";import"./VOverlay-CUgN-6sb.js";import"./scopeId-Cih-qwPH.js";const ae={class:"d-flex align-center"},le={class:"permissions-tree"},ie={key:0,class:"permission-category"},se={class:"ms-8"},oe={__name:"rolePermissions",setup(ne){I();const p=d(!1),V=d(!1),n=d(""),c=d(""),b=d([{id:"admin",name:"系統管理員"},{id:"coach",name:"教練"},{id:"analyst",name:"數據分析師"},{id:"doctor",name:"醫療人員"},{id:"athlete",name:"選手"}]),r=d([{id:"physiological",name:"生理監控",nameEn:"Physiological",items:[{id:"template1",name:"選手生理監測儀表板"},{id:"template2",name:"生理狀態綜合儀表板"},{id:"template3",name:"運動生理數據總覽"}]},{id:"psychological",name:"心理監控",nameEn:"Psychological",items:[{id:"template1",name:"心理健康與壓力監控儀表板"},{id:"template2",name:"選手心理狀態追蹤儀表板"},{id:"template3",name:"心理與恢復趨勢總覽"}]},{id:"nutrition",name:"營養監控",nameEn:"Nutrition / Hydration",items:[{id:"template1",name:"水分補給與代謝監控儀表板"},{id:"template2",name:"營養補給行為分析儀表板"},{id:"template3",name:"飲水與汗液電解平衡儀表板"}]},{id:"performance",name:"體能監控",nameEn:"Performance",items:[{id:"template1",name:"體能表現與爆發力分析儀表板"},{id:"template2",name:"跳躍能力與肌肉性分析儀表板"}]}]),l=A({});(()=>{r.value.forEach(t=>{l[t.id]={selected:!1,indeterminate:!1,expanded:!0,items:{}},t.items.forEach(e=>{l[t.id].items[e.id]=!1})})})(),D(()=>!!n.value);const _=async t=>{if(t){p.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),j(t)}catch(e){console.error("載入權限失敗:",e)}finally{p.value=!1}}},j=t=>{switch(g(),t){case"admin":B(!0);break;case"coach":l.physiological.items.template1=!0,l.psychological.items.template1=!0,l.nutrition.items.template1=!0,l.performance.items.template1=!0;break;case"analyst":l.physiological.items.template2=!0,l.psychological.items.template3=!0,l.nutrition.items.template2=!0,l.performance.items.template2=!0;break;case"doctor":l.physiological.items.template1=!0,l.physiological.items.template2=!0,l.psychological.items.template1=!0;break;case"athlete":l.physiological.items.template1=!0,l.psychological.items.template2=!0;break}$()},B=t=>{r.value.forEach(e=>{e.items.forEach(a=>{l[e.id].items[a.id]=t}),l[e.id].selected=t,l[e.id].indeterminate=!1})},z=t=>{const e=l[t],a=!e.selected||e.indeterminate;Object.keys(e.items).forEach(o=>{e.items[o]=a}),C(t)},C=t=>{const e=l[t],a=Object.values(e.items),o=a.filter(O=>O).length,f=a.length;o===0?(e.selected=!1,e.indeterminate=!1):o===f?(e.selected=!0,e.indeterminate=!1):(e.selected=!1,e.indeterminate=!0)},$=()=>{r.value.forEach(t=>{C(t.id)})},g=()=>{r.value.forEach(t=>{l[t.id].selected=!1,l[t.id].indeterminate=!1,t.items.forEach(e=>{l[t.id].items[e.id]=!1})})},L=async()=>{if(!n.value){alert("請先選擇角色");return}V.value=!0;try{const t={};r.value.forEach(e=>{t[e.id]=[],e.items.forEach(a=>{l[e.id].items[a.id]&&t[e.id].push(a.id)})}),await new Promise(e=>setTimeout(e,1500)),console.log("儲存權限設定:",{roleId:n.value,permissions:t}),alert("權限設定已儲存")}catch(t){console.error("儲存權限失敗:",t),alert("儲存失敗，請重試")}finally{V.value=!1}},N=async()=>{if(!n.value){alert("請先選擇角色");return}try{const t=new Blob(["權限清查表內容"],{type:"application/zip"}),e=window.URL.createObjectURL(t),a=document.createElement("a");a.href=e,a.download=`權限清查表_${n.value}_${new Date().getTime()}.zip`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(e)}catch(t){console.error("下載失敗:",t),alert("下載失敗，請重試")}},S=()=>{c.value.trim()&&console.log("搜尋權限:",c.value)};return F(c,t=>{t||r.value.forEach(e=>{l[e.id].expanded=!0})}),H(()=>{b.value.length>0&&(n.value=b.value[0].id,_(n.value))}),(t,e)=>(m(),x(Q,{fluid:""},{default:s(()=>[i(P,null,{default:s(()=>[i(k,{cols:"12",md:"4"},{default:s(()=>[i(W,{modelValue:n.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>n.value=a),_],items:b.value,"item-title":"name","item-value":"id",label:"選擇角色",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),i(k,{cols:"12",md:"8",class:"d-flex justify-end"},{default:s(()=>[i(v,{color:"primary","prepend-icon":"mdi-download",onClick:N},{default:s(()=>[...e[3]||(e[3]=[y(" 下載權限清查表 ",-1)])]),_:1})]),_:1})]),_:1}),i(P,null,{default:s(()=>[i(k,{cols:"12"},{default:s(()=>[i(U,{class:"permission-card"},{default:s(()=>[i(Y,{class:"d-flex justify-space-between align-center"},{default:s(()=>[e[4]||(e[4]=u("span",null,"儀表板",-1)),u("div",ae,[i(K,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),"prepend-inner-icon":"mdi-magnify",placeholder:"搜尋",variant:"outlined",density:"compact",width:"300","hide-details":"",clearable:"",class:"me-2"},null,8,["modelValue"]),i(v,{color:"primary",onClick:S,text:"尋找"})])]),_:1}),i(R,null,{default:s(()=>[u("div",le,[(m(!0),h(w,null,E(r.value,a=>(m(),h(w,{key:a.id},[l[a.id]?(m(),h("div",ie,[i(T,{modelValue:l[a.id].selected,"onUpdate:modelValue":o=>l[a.id].selected=o,indeterminate:l[a.id].indeterminate,"hide-details":"",label:`${a.name} (${a.nameEn})`,color:"teal",class:"category-checkbox",onChange:o=>z(a.id)},null,8,["modelValue","onUpdate:modelValue","indeterminate","label","onChange"]),q(u("div",se,[(m(!0),h(w,null,E(a.items,o=>(m(),x(T,{key:o.id,modelValue:l[a.id].items[o.id],"onUpdate:modelValue":f=>l[a.id].items[o.id]=f,label:o.name,"hide-details":"",color:"teal",class:"subcategory-checkbox",onChange:f=>C(a.id)},null,8,["modelValue","onUpdate:modelValue","label","onChange"]))),128))],512),[[G,l[a.id].expanded]])])):M("",!0)],64))),128))])]),_:1}),i(Z,{class:"pa-4"},{default:s(()=>[i(ee),i(v,{color:"grey",variant:"outlined",onClick:g},{default:s(()=>[...e[5]||(e[5]=[y(" 重置 ",-1)])]),_:1}),i(v,{color:"primary",onClick:L,loading:V.value},{default:s(()=>[...e[6]||(e[6]=[y(" 儲存設定 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),i(te,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=a=>p.value=a),persistent:"",width:"300"},{default:s(()=>[i(U,null,{default:s(()=>[i(R,{class:"text-center pa-6"},{default:s(()=>[i(X,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),e[7]||(e[7]=u("div",null,"載入中...",-1))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ue=J(oe,[["__scopeId","data-v-7a76098a"]]);export{Ue as default};

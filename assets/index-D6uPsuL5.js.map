{"version":3,"file":"index-D6uPsuL5.js","sources":["../../src/views/functions/tree.vue","../../src/views/functions/index.vue"],"sourcesContent":["<template>\r\n  <div ref=\"el\"></div>\r\n</template>\r\n\r\n<script setup>\r\nimport { functions } from \"@/requests\";\r\nimport { alertError } from \"@/helpers/functions\";\r\nimport { onMounted, inject, ref } from \"vue\";\r\n\r\nconst $parent = inject('functions')\r\nconst el = ref(null)\r\nconst update = () => {\r\n  $parent.update();\r\n}\r\nconst load = () => {\r\n  functions.get().then(a => {\r\n    $(el.value).jstree(true).settings.core.data = a.data;\r\n    $(el.value)\r\n      .jstree(true)\r\n      .refresh();\r\n  });\r\n}\r\n\r\nonMounted(() => {\r\n  $(el.value)\r\n    .jstree({\r\n      plugins: [\"state\", \"sort\", \"dnd\", \"types\", \"contextmenu\"],\r\n      core: {\r\n        check_callback(operation, node, node_parent, node_position, more) {\r\n          if (operation === \"delete_node\") return confirm(\"確定要刪除嗎？\");\r\n          if (operation === \"move_node\" && !more.dnd)\r\n            return confirm(\"確定要移動嗎？\");\r\n        },\r\n        themes: {\r\n          name: \"default\",\r\n        }\r\n      },\r\n      sort: function (a, b) {\r\n        let types = { menu: 1, page: 2, operation: 3, api: 4 };\r\n        let type1 = types[this.get_type(a)];\r\n        let type2 = types[this.get_type(b)];\r\n        if (type1 != type2) return type1 > type2 ? 1 : -1;\r\n      },\r\n      contextmenu: {\r\n        items: function (node) {\r\n          var tmp = $.jstree.defaults.contextmenu.items();\r\n          delete tmp.create.action;\r\n          tmp.create.submenu = {\r\n            menu: {\r\n              label: \"Menu\",\r\n              action: function (data) {\r\n                var inst = $.jstree.reference(data.reference),\r\n                  obj = inst.get_node(data.reference);\r\n                inst.create_node(obj, { type: \"menu\" }, \"last\");\r\n              }\r\n            },\r\n            page: {\r\n              label: \"Page\",\r\n              action: function (data) {\r\n                var inst = $.jstree.reference(data.reference),\r\n                  obj = inst.get_node(data.reference);\r\n                inst.create_node(obj, { type: \"page\" }, \"last\");\r\n              }\r\n            },\r\n            operation: {\r\n              label: \"Operation\",\r\n              action: function (data) {\r\n                var inst = $.jstree.reference(data.reference),\r\n                  obj = inst.get_node(data.reference);\r\n                inst.create_node(obj, { type: \"operation\" }, \"last\");\r\n              }\r\n            },\r\n            api: {\r\n              label: \"Api\",\r\n              action: function (data) {\r\n                var inst = $.jstree.reference(data.reference),\r\n                  obj = inst.get_node(data.reference);\r\n                inst.create_node(obj, { type: \"api\" }, \"last\");\r\n              }\r\n            }\r\n          };\r\n\r\n          tmp.create.label = \"新增\";\r\n          tmp.rename.label = \"重新命名\";\r\n          tmp.remove.label = \"移除\";\r\n          tmp.ccp.label = \"動作\";\r\n          tmp.ccp.submenu.cut.label = \"剪下\";\r\n          tmp.ccp.submenu.copy.label = \"複製\";\r\n          tmp.ccp.submenu.paste.label = \"貼上\";\r\n\r\n          if (this.get_type(node) === \"root\") {\r\n            delete tmp.create.submenu.page;\r\n            delete tmp.create.submenu.operation;\r\n            delete tmp.create.submenu.api;\r\n            delete tmp.rename;\r\n            delete tmp.remove;\r\n            delete tmp.ccp.submenu.cut;\r\n            delete tmp.ccp.submenu.copy;\r\n          }\r\n          if (this.get_type(node) === \"menu\") {\r\n            delete tmp.create.submenu.operation;\r\n            delete tmp.create.submenu.api;\r\n          }\r\n          if (this.get_type(node) === \"page\") {\r\n            delete tmp.create.submenu.menu;\r\n          }\r\n          if (this.get_type(node) === \"operation\") {\r\n            delete tmp.create.submenu.menu;\r\n            delete tmp.create.submenu.page;\r\n            delete tmp.create.submenu.operation;\r\n          }\r\n          if (this.get_type(node) === \"api\") {\r\n            delete tmp.create;\r\n          }\r\n\r\n          return tmp;\r\n        }\r\n      },\r\n      types: {\r\n        \"#\": {\r\n          valid_children: [\"root\"]\r\n        },\r\n        root: {\r\n          valid_children: [\"menu\"]\r\n        },\r\n        menu: {\r\n          valid_children: [\"menu\", \"page\"],\r\n          icon: \"mdi mdi-folder text-warning\"\r\n        },\r\n        page: {\r\n          valid_children: [\"page\", \"operation\", \"api\"],\r\n          icon: \"mdi mdi-file text-primary\"\r\n        },\r\n        operation: {\r\n          valid_children: [\"api\"],\r\n          icon: \"mdi mdi-cog text-success\"\r\n        },\r\n        api: { valid_children: [], icon: \"mdi mdi-link text-red\" }\r\n      }\r\n    })\r\n    .on(\"delete_node.jstree\", function (e, data) {\r\n      var parent = data.instance.get_node(data.node.parent);\r\n      functions.delete({\r\n        id: data.node.id,\r\n        type: data.node.type\r\n      }, {\r\n        id: data.node.id,\r\n        parentId: parent.original.id,\r\n        parentType: parent.type\r\n      }).then(a => {\r\n        update();\r\n      }).catch(alertError);\r\n    })\r\n    .on(\"create_node.jstree\", function (e, data) {\r\n      var parent = data.instance.get_node(data.node.parent);\r\n      functions\r\n        .save(\r\n          { type: data.node.type },\r\n          {\r\n            text: data.node.text,\r\n            parentId: parent.original.id,\r\n            parentType: parent.type,\r\n            position: data.position\r\n          }\r\n        )\r\n        .then(a => {\r\n          data.node.original.id = a.data.id;\r\n          data.instance.set_id(data.node, a.data.id);\r\n          data.instance.edit(data.node);\r\n          update();\r\n        })\r\n        .catch(alertError);\r\n    })\r\n    .on(\"rename_node.jstree\", function (e, data) {\r\n      var [text, url] = data.node.text.split(\" /\");\r\n      functions.rename({\r\n        id: data.node.id,\r\n        type: data.node.type\r\n      }, {\r\n        id: data.node.id,\r\n        text: text,\r\n        url: url ? \"/\" + url : null\r\n      }).then(a => {\r\n        update();\r\n      }).catch(alertError);\r\n    })\r\n    .on(\"move_node.jstree\", function (e, data) {\r\n      var parent = data.instance.get_node(data.parent);\r\n      var oldParent = data.instance.get_node(data.old_parent);\r\n      functions\r\n        .move(\r\n          {\r\n            id: data.node.id,\r\n            type: data.node.type\r\n          },\r\n          {\r\n            id: data.node.id,\r\n            parentId: parent.original.id,\r\n            parentType: parent.type,\r\n            position: data.position,\r\n            oldParentId: oldParent.original.id,\r\n            oldParentType: oldParent.type,\r\n            oldPosition: data.old_position\r\n          }\r\n        )\r\n        .then(a => {\r\n          update();\r\n        })\r\n        .catch(alertError);\r\n    })\r\n    .on(\"copy_node.jstree\", function (e, data) {\r\n      let newParent = data.instance.get_node(data.parent);\r\n      let oldParent = data.instance.get_node(data.old_parent);\r\n      functions\r\n        .copy(\r\n          {\r\n            id: data.original.id,\r\n            type: data.node.type\r\n          },\r\n          {\r\n            id: data.original.id,\r\n            type: data.node.type,\r\n            parentId: newParent.original.id,\r\n            parentType: newParent.type,\r\n            oldParentId: oldParent.original.id,\r\n            oldParentType: oldParent.type,\r\n            position: data.position,\r\n            oldPosition: data.old_position\r\n          }\r\n        )\r\n        .then(a => {\r\n          load();\r\n          update();\r\n        })\r\n        .catch(alertError);\r\n    });\r\n  load();\r\n})\r\n</script>\r\n","<template>\r\n  <v-card>\r\n    <v-toolbar>\r\n      <v-toolbar-title>{{ $root.subTitle }}</v-toolbar-title>\r\n    </v-toolbar>\r\n    <v-card-item>\r\n      <tree />\r\n    </v-card-item>\r\n  </v-card>\r\n</template>\r\n\r\n<script setup>\r\nimport Tree from \"./tree\";\r\nimport { functions } from \"@/requests\";\r\nimport { alertError } from \"@/helpers/functions\";\r\nimport { ref, inject, provide } from \"vue\";\r\n\r\nconst menu = inject('menu')\r\nconst form = ref({\r\n  id: null,\r\n  icon: null\r\n})\r\n\r\nconst update = () => {\r\n  menu.value.load(true);\r\n}\r\n\r\nconst submit = () => {\r\n  functions\r\n    .update(\r\n      {\r\n        id: form.value.id,\r\n        type: form.value.type\r\n      },\r\n      form.value\r\n    )\r\n    .then(a => {\r\n      update();\r\n      popup.value.hide();\r\n    })\r\n    .catch(alertError);\r\n}\r\n\r\nprovide('functions', {\r\n  update, submit\r\n})\r\n</script>\r\n"],"names":["$parent","inject","el","ref","update","load","functions","a","onMounted","operation","node","node_parent","node_position","more","b","types","type1","type2","tmp","data","inst","obj","e","parent","alertError","text","url","oldParent","newParent","_createElementBlock","menu","form","provide","_createBlock","_component_v_card","_createVNode","_component_v_toolbar","_component_v_toolbar_title","$root","_component_v_card_item","_unref","Tree"],"mappings":"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"}
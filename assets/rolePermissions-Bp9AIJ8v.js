import{f as r,P as O,E as A,M as D,h as F,b as u,e as s,w as i,F as v,q as M,o as m,x as q,n as V,m as w,d as p,s as H,z as x,B as I,l as Q,j as G,Q as J,S as W}from"./index-DsLPX3BI.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as E,a as k}from"./VRow-NzVItThu.js";import{V as Y}from"./VDialog-nugxKd2C.js";import{V as P,a as Z,b as U,c as K}from"./VCard-CL4EWFtp.js";import{V as R}from"./VCheckbox-C4HdV1oL.js";import{V as ee}from"./VSpacer-C1XAD_mX.js";/* empty css              */const te={class:"d-flex align-center"},ae={class:"permissions-tree"},le={key:0,class:"permission-category"},se={class:"ms-8"},ie={__name:"rolePermissions",setup(oe){M();const f=r(!1),b=r(!1),n=r(""),c=r(""),y=r([{id:"admin",name:"系統管理員"},{id:"coach",name:"教練"},{id:"analyst",name:"數據分析師"},{id:"doctor",name:"醫療人員"},{id:"athlete",name:"選手"}]),d=r([{id:"physiological",name:"生理監控",nameEn:"Physiological",items:[{id:"template1",name:"選手生理監測儀表板"},{id:"template2",name:"生理狀態綜合儀表板"},{id:"template3",name:"運動生理數據總覽"}]},{id:"psychological",name:"心理監控",nameEn:"Psychological",items:[{id:"template1",name:"心理健康與壓力監控儀表板"},{id:"template2",name:"選手心理狀態追蹤儀表板"},{id:"template3",name:"心理與恢復趨勢總覽"}]},{id:"nutrition",name:"營養監控",nameEn:"Nutrition / Hydration",items:[{id:"template1",name:"水分補給與代謝監控儀表板"},{id:"template2",name:"營養補給行為分析儀表板"},{id:"template3",name:"飲水與汗液電解平衡儀表板"}]},{id:"performance",name:"體能監控",nameEn:"Performance",items:[{id:"template1",name:"體能表現與爆發力分析儀表板"},{id:"template2",name:"跳躍能力與肌肉性分析儀表板"}]}]),l=O({});(()=>{d.value.forEach(t=>{l[t.id]={selected:!1,indeterminate:!1,expanded:!0,items:{}},t.items.forEach(e=>{l[t.id].items[e.id]=!1})})})(),A(()=>!!n.value);const _=async t=>{if(t){f.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),B(t)}catch(e){console.error("載入權限失敗:",e)}finally{f.value=!1}}},B=t=>{switch(g(),t){case"admin":T(!0);break;case"coach":l.physiological.items.template1=!0,l.psychological.items.template1=!0,l.nutrition.items.template1=!0,l.performance.items.template1=!0;break;case"analyst":l.physiological.items.template2=!0,l.psychological.items.template3=!0,l.nutrition.items.template2=!0,l.performance.items.template2=!0;break;case"doctor":l.physiological.items.template1=!0,l.physiological.items.template2=!0,l.psychological.items.template1=!0;break;case"athlete":l.physiological.items.template1=!0,l.psychological.items.template2=!0;break}z()},T=t=>{d.value.forEach(e=>{e.items.forEach(a=>{l[e.id].items[a.id]=t}),l[e.id].selected=t,l[e.id].indeterminate=!1})},j=t=>{const e=l[t],a=!e.selected||e.indeterminate;Object.keys(e.items).forEach(o=>{e.items[o]=a}),C(t)},C=t=>{const e=l[t],a=Object.values(e.items),o=a.filter(N=>N).length,h=a.length;o===0?(e.selected=!1,e.indeterminate=!1):o===h?(e.selected=!0,e.indeterminate=!1):(e.selected=!1,e.indeterminate=!0)},z=()=>{d.value.forEach(t=>{C(t.id)})},g=()=>{d.value.forEach(t=>{l[t.id].selected=!1,l[t.id].indeterminate=!1,t.items.forEach(e=>{l[t.id].items[e.id]=!1})})},S=async()=>{if(!n.value){alert("請先選擇角色");return}b.value=!0;try{const t={};d.value.forEach(e=>{t[e.id]=[],e.items.forEach(a=>{l[e.id].items[a.id]&&t[e.id].push(a.id)})}),await new Promise(e=>setTimeout(e,1500)),console.log("儲存權限設定:",{roleId:n.value,permissions:t}),alert("權限設定已儲存")}catch(t){console.error("儲存權限失敗:",t),alert("儲存失敗，請重試")}finally{b.value=!1}},$=async()=>{if(!n.value){alert("請先選擇角色");return}try{const t=new Blob(["權限清查表內容"],{type:"application/zip"}),e=window.URL.createObjectURL(t),a=document.createElement("a");a.href=e,a.download=`權限清查表_${n.value}_${new Date().getTime()}.zip`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(e)}catch(t){console.error("下載失敗:",t),alert("下載失敗，請重試")}},L=()=>{c.value.trim()&&console.log("搜尋權限:",c.value)};return D(c,t=>{t||d.value.forEach(e=>{l[e.id].expanded=!0})}),F(()=>{y.value.length>0&&(n.value=y.value[0].id,_(n.value))}),(t,e)=>(m(),u(v,null,[s(E,null,{default:i(()=>[s(k,{cols:"12",md:"4"},{default:i(()=>[s(q,{modelValue:n.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>n.value=a),_],items:y.value,"item-title":"name","item-value":"id",label:"選擇角色",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),s(k,{cols:"12",md:"8",class:"d-flex justify-end"},{default:i(()=>[s(V,{color:"primary","prepend-icon":"mdi-download",onClick:$},{default:i(()=>[...e[3]||(e[3]=[w(" 下載權限清查表 ",-1)])]),_:1})]),_:1})]),_:1}),s(E,null,{default:i(()=>[s(k,{cols:"12"},{default:i(()=>[s(P,{class:"permission-card"},{default:i(()=>[s(Z,{class:"d-flex justify-space-between align-center"},{default:i(()=>[e[4]||(e[4]=p("span",null,"儀表板",-1)),p("div",te,[s(H,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),"prepend-inner-icon":"mdi-magnify",placeholder:"搜尋",variant:"outlined",density:"compact",width:"300","hide-details":"",clearable:"",class:"me-2"},null,8,["modelValue"]),s(V,{color:"primary",onClick:L,text:"尋找"})])]),_:1}),s(U,null,{default:i(()=>[p("div",ae,[(m(!0),u(v,null,x(d.value,a=>(m(),u(v,{key:a.id},[l[a.id]?(m(),u("div",le,[s(R,{modelValue:l[a.id].selected,"onUpdate:modelValue":o=>l[a.id].selected=o,indeterminate:l[a.id].indeterminate,"hide-details":"",label:`${a.name} (${a.nameEn})`,color:"teal",class:"category-checkbox",onChange:o=>j(a.id)},null,8,["modelValue","onUpdate:modelValue","indeterminate","label","onChange"]),Q(p("div",se,[(m(!0),u(v,null,x(a.items,o=>(m(),G(R,{key:o.id,modelValue:l[a.id].items[o.id],"onUpdate:modelValue":h=>l[a.id].items[o.id]=h,label:o.name,"hide-details":"",color:"teal",class:"subcategory-checkbox",onChange:h=>C(a.id)},null,8,["modelValue","onUpdate:modelValue","label","onChange"]))),128))],512),[[J,l[a.id].expanded]])])):I("",!0)],64))),128))])]),_:1}),s(K,{class:"pa-4"},{default:i(()=>[s(ee),s(V,{color:"grey",variant:"outlined",onClick:g},{default:i(()=>[...e[5]||(e[5]=[w(" 重置 ",-1)])]),_:1}),s(V,{color:"primary",onClick:S,loading:b.value},{default:i(()=>[...e[6]||(e[6]=[w(" 儲存設定 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),s(Y,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=a=>f.value=a),persistent:"",width:"300"},{default:i(()=>[s(P,null,{default:i(()=>[s(U,{class:"text-center pa-6"},{default:i(()=>[s(W,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),e[7]||(e[7]=p("div",null,"載入中...",-1))]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},ve=X(ie,[["__scopeId","data-v-33ae3d55"]]);export{ve as default};

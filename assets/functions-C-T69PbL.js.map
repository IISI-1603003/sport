{"version":3,"file":"functions-C-T69PbL.js","sources":["../../src/views/roles/functions.vue"],"sourcesContent":["<template>\r\n  <div ref=\"root\"></div>\r\n</template>\r\n\r\n<script setup>\r\nimport { roles } from \"@/requests\";\r\nimport { ref, onMounted } from \"vue\";\r\nconst emit = defineEmits(['change'])\r\nconst selected = ref([])\r\nconst root = ref()\r\nconst deselectAll = () => {\r\n  $(root.value).jstree(\"close_all\");\r\n  $(root.value).jstree(\"deselect_all\");\r\n}\r\nconst selection = (list) => selected.value = list\r\nconst change = (list) => {\r\n  let menus = [],\r\n    pages = [],\r\n    operations = [],\r\n    apis = [];\r\n  list.forEach(a => {\r\n    switch (a.type) {\r\n      case \"menu\":\r\n        menus.push(a.id);\r\n        break;\r\n      case \"page\":\r\n        pages.push(a.id);\r\n        break;\r\n      case \"operation\":\r\n        operations.push(a.id);\r\n        break;\r\n      case \"api\":\r\n        apis.push(a.id);\r\n        break;\r\n    }\r\n  });\r\n  emit(\"change\", { menus, pages, operations, apis });\r\n}\r\nonMounted(() => {\r\n  roles.functions().then(a => {\r\n    $(root.value)\r\n      .jstree({\r\n        plugins: [\"types\", \"checkbox\"],\r\n        core: {\r\n          data: a.data,\r\n          themes: {\r\n            name: \"default\",\r\n          }\r\n        },\r\n        sort: function (a, b) {\r\n          let types = { menu: 1, page: 2, api: 3 };\r\n          return types[this.get_type(a)] > types[this.get_type(b)] ? 1 : -1;\r\n        },\r\n        types: {\r\n          \"#\": {\r\n            valid_children: [\"menu\"]\r\n          },\r\n          menu: {\r\n            valid_children: [\"menu\", \"page\"],\r\n            icon: \"mdi mdi-folder text-warning\"\r\n          },\r\n          page: {\r\n            valid_children: [\"page\", \"operation\", \"api\"],\r\n            icon: \"mdi mdi-file text-primary\"\r\n          },\r\n          operation: {\r\n            valid_children: [\"api\"],\r\n            icon: \"mdi mdi-cog text-success\"\r\n          },\r\n          api: { valid_children: [], icon: \"mdi mdi-link text-red\" }\r\n        }\r\n      })\r\n      .on(\"ready.jstree\", (e, data) => {\r\n        let list = data.instance.get_checked(true);\r\n        change(list);\r\n        let jstree = $(root.value).jstree(true);\r\n        selected.value.forEach(a => {\r\n          jstree.select_node(a);\r\n        });\r\n      })\r\n      .on(\"select_node.jstree deselect_node.jstree\", (e, data) => {\r\n        let list = data.instance.get_checked(true);\r\n        change(list);\r\n      });\r\n  });\r\n})\r\ndefineExpose({ deselectAll, selection })\r\n</script>\r\n"],"names":["emit","__emit","selected","ref","root","deselectAll","selection","list","change","menus","pages","operations","apis","a","onMounted","roles","b","types","e","data","jstree","__expose","_createElementBlock"],"mappings":"4IAOA,MAAMA,EAAOC,EACPC,EAAWC,EAAI,EAAE,EACjBC,EAAOD,EAAG,EACVE,EAAc,IAAM,CACxB,EAAED,EAAK,KAAK,EAAE,OAAO,WAAW,EAChC,EAAEA,EAAK,KAAK,EAAE,OAAO,cAAc,CACrC,EACME,EAAaC,GAASL,EAAS,MAAQK,EACvCC,EAAUD,GAAS,CACvB,IAAIE,EAAQ,CAAA,EACVC,EAAQ,CAAA,EACRC,EAAa,CAAA,EACbC,EAAO,CAAA,EACTL,EAAK,QAAQM,GAAK,CAChB,OAAQA,EAAE,KAAI,CACZ,IAAK,OACHJ,EAAM,KAAKI,EAAE,EAAE,EACf,MACF,IAAK,OACHH,EAAM,KAAKG,EAAE,EAAE,EACf,MACF,IAAK,YACHF,EAAW,KAAKE,EAAE,EAAE,EACpB,MACF,IAAK,MACHD,EAAK,KAAKC,EAAE,EAAE,EACd,KACR,CACE,CAAC,EACDb,EAAK,SAAU,CAAE,MAAAS,EAAO,MAAAC,EAAO,WAAAC,EAAY,KAAAC,CAAI,CAAE,CACnD,EACA,OAAAE,EAAU,IAAM,CACdC,EAAM,UAAS,EAAG,KAAK,GAAK,CAC1B,EAAEX,EAAK,KAAK,EACT,OAAO,CACN,QAAS,CAAC,QAAS,UAAU,EAC7B,KAAM,CACJ,KAAM,EAAE,KACR,OAAQ,CACN,KAAM,SAClB,CACA,EACQ,KAAM,SAAUS,EAAGG,EAAG,CACpB,IAAIC,EAAQ,CAAE,KAAM,EAAG,KAAM,EAAG,IAAK,GACrC,OAAOA,EAAM,KAAK,SAASJ,CAAC,CAAC,EAAII,EAAM,KAAK,SAASD,CAAC,CAAC,EAAI,EAAI,EACjE,EACA,MAAO,CACL,IAAK,CACH,eAAgB,CAAC,MAAM,CACnC,EACU,KAAM,CACJ,eAAgB,CAAC,OAAQ,MAAM,EAC/B,KAAM,6BAClB,EACU,KAAM,CACJ,eAAgB,CAAC,OAAQ,YAAa,KAAK,EAC3C,KAAM,2BAClB,EACU,UAAW,CACT,eAAgB,CAAC,KAAK,EACtB,KAAM,0BAClB,EACU,IAAK,CAAE,eAAgB,GAAI,KAAM,uBAAuB,CAClE,CACA,CAAO,EACA,GAAG,eAAgB,CAACE,EAAGC,IAAS,CAC/B,IAAIZ,EAAOY,EAAK,SAAS,YAAY,EAAI,EACzCX,EAAOD,CAAI,EACX,IAAIa,EAAS,EAAEhB,EAAK,KAAK,EAAE,OAAO,EAAI,EACtCF,EAAS,MAAM,QAAQW,GAAK,CAC1BO,EAAO,YAAYP,CAAC,CACtB,CAAC,CACH,CAAC,EACA,GAAG,0CAA2C,CAACK,EAAGC,IAAS,CAC1D,IAAIZ,EAAOY,EAAK,SAAS,YAAY,EAAI,EACzCX,EAAOD,CAAI,CACb,CAAC,CACL,CAAC,CACH,CAAC,EACDc,EAAa,CAAE,YAAAhB,EAAa,UAAAC,EAAW,cArFrCgB,EAAsB,MAAA,SAAb,OAAJ,IAAIlB"}
import{R as Me,S as Ee,T as Be,e as x,U as B,W as Le,X as Te,Y as le,Z as $e,H as b,_ as Oe,$ as ze,a0 as Ke,a1 as je,N as j,Q as se,a2 as He,a3 as Je,t as oe,d as o,E as U,a4 as Qe,a5 as We,a6 as qe,a7 as Xe,a8 as Ye,a9 as Ze,aa as re,ab as ie,ac as Ge,b as C,V as W,ad as el,F as Q,ae as ll,af as al,ag as ce,ah as tl,ai as nl,aj as ul,ak as sl,al as ol,am as rl,an as il,ao as cl,ap as vl,J as he,aq as dl,m as P,f as fl,i as L,a as ae,n as ml,w as k,u as w,y as pl,o as H,q as ve,z as de,l as te,p as fe,ar as ne,j as hl}from"./index-1UwmURaf.js";import{_ as yl}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as me,a as J}from"./VRow--M4qGh76.js";/* empty css              */const gl=Ee({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...Ye({filterKeys:["title"]}),...Xe(),...qe(Ze({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...We({transition:!1})},"VAutocomplete"),pe=Me()({name:"VAutocomplete",props:gl(),emits:{"update:focused":l=>!0,"update:search":l=>!0,"update:modelValue":l=>!0,"update:menu":l=>!0},setup(l,R){let{slots:n}=R;const{t:I}=Be(),d=x(),V=B(!1),p=B(!0),D=B(!1),T=x(),F=x(),i=B(-1),{items:A,transformIn:q,transformOut:c}=Le(l),{textColorClasses:u,textColorStyles:h}=Te(()=>d.value?.color),v=le(l,"search",""),s=le(l,"modelValue",[],e=>q(e===null?[null]:$e(e)),e=>{const r=c(e);return l.multiple?r:r[0]??null}),ye=b(()=>typeof l.counterValue=="function"?l.counterValue(s.value):typeof l.counterValue=="number"?l.counterValue:s.value.length),$=Oe(l),{filteredItems:X,getMatches:ge}=ze(l,A,()=>p.value?"":v.value),S=b(()=>l.hideSelected?X.value.filter(e=>!s.value.some(r=>r.value===e.value)):X.value),O=b(()=>!!(l.chips||n.chip)),N=b(()=>O.value||!!n.selection),Ve=b(()=>s.value.map(e=>e.props.value)),Y=b(()=>(l.autoSelectFirst===!0||l.autoSelectFirst==="exact"&&v.value===S.value[0]?.title)&&S.value.length>0&&!p.value&&!D.value),z=b(()=>l.hideNoData&&!S.value.length||$.isReadonly.value||$.isDisabled.value),Z=le(l,"menu"),f=b({get:()=>Z.value,set:e=>{Z.value&&!e&&T.value?.ΨopenChildren.size||e&&z.value||(Z.value=e)}}),{menuId:ke,ariaExpanded:we,ariaControls:xe,ariaLabel:ue}=Ke(l,f),G=x(),Se=je(G,d);function be(e){l.openOnClear&&(f.value=!0),v.value=""}function Ce(){z.value||(f.value=!0)}function Ie(e){z.value||(V.value&&(e.preventDefault(),e.stopPropagation()),f.value=!f.value)}function De(e){(re(e)||e.key==="Backspace")&&d.value?.focus()}function Ue(e){if($.isReadonly.value)return;const r=d.value?.selectionStart,m=s.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(f.value=!0),["Escape"].includes(e.key)&&(f.value=!1),Y.value&&["Enter","Tab"].includes(e.key)&&!s.value.some(t=>{let{value:a}=t;return a===S.value[0].value})&&_(S.value[0]),e.key==="ArrowDown"&&Y.value&&G.value?.focus("next"),["Backspace","Delete"].includes(e.key)){if(!l.multiple&&N.value&&s.value.length>0&&!v.value)return _(s.value[0],!1);if(~i.value){e.preventDefault();const t=i.value;_(s.value[i.value],!1),i.value=t>=m-1?m-2:t}else e.key==="Backspace"&&!v.value&&(i.value=m-1);return}if(l.multiple)if(e.key==="ArrowLeft"){if(i.value<0&&r&&r>0)return;const t=i.value>-1?i.value-1:m-1;if(s.value[t])i.value=t;else{const a=v.value?.length??null;i.value=-1,d.value?.setSelectionRange(a,a)}}else if(e.key==="ArrowRight"){if(i.value<0)return;const t=i.value+1;s.value[t]?i.value=t:(i.value=-1,d.value?.setSelectionRange(0,0))}else~i.value&&re(e)&&(i.value=-1)}function _e(e){if(ie(d.value,":autofill")||ie(d.value,":-webkit-autofill")){const r=A.value.find(m=>m.title===e.target.value);r&&_(r)}}function Fe(){l.eager&&F.value?.calculateVisibleItems()}function Pe(){V.value&&(p.value=!0,d.value?.focus())}function Re(e){V.value=!0,setTimeout(()=>{D.value=!0})}function Ae(e){D.value=!1}function Ne(e){(e==null||e===""&&!l.multiple&&!N.value)&&(s.value=[])}const ee=B(!1);function _(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!e||e.props.disabled))if(l.multiple){const m=s.value.findIndex(a=>(l.valueComparator||Ge)(a.value,e.value)),t=r??!~m;if(~m){const a=t?[...s.value,e]:[...s.value];a.splice(m,1),s.value=a}else t&&(s.value=[...s.value,e]);l.clearOnSelect&&(v.value="")}else{const m=r!==!1;s.value=m?[e]:[],v.value=m&&!N.value?e.title:"",se(()=>{f.value=!1,p.value=!0})}}return j(V,(e,r)=>{e!==r&&(e?(ee.value=!0,v.value=l.multiple||N.value?"":String(s.value.at(-1)?.props.title??""),p.value=!0,se(()=>ee.value=!1)):(!l.multiple&&v.value==null&&(s.value=[]),f.value=!1,v.value="",i.value=-1))}),j(v,e=>{!V.value||ee.value||(e&&(f.value=!0),p.value=!e)}),j(f,()=>{if(!l.hideSelected&&f.value&&s.value.length){const e=S.value.findIndex(r=>s.value.some(m=>r.value===m.value));He&&window.requestAnimationFrame(()=>{e>=0&&F.value?.scrollToIndex(e)})}}),j(A,(e,r)=>{f.value||V.value&&!r.length&&e.length&&(f.value=!0)}),Je(()=>{const e=!!(!l.hideNoData||S.value.length||n["prepend-item"]||n["append-item"]||n["no-data"]),r=s.value.length>0,m=oe.filterProps(l);return o(oe,U({ref:d},m,{modelValue:v.value,"onUpdate:modelValue":[t=>v.value=t,Ne],focused:V.value,"onUpdate:focused":t=>V.value=t,validationValue:s.externalValue,counterValue:ye.value,dirty:r,onChange:_e,class:["v-autocomplete",`v-autocomplete--${l.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":f.value,"v-autocomplete--chips":!!l.chips,"v-autocomplete--selection-slot":!!N.value,"v-autocomplete--selecting-index":i.value>-1},l.class],style:l.style,readonly:$.isReadonly.value,placeholder:r?void 0:l.placeholder,"onClick:clear":be,"onMousedown:control":Ce,onKeydown:Ue,"aria-expanded":we.value,"aria-controls":xe.value}),{...n,default:()=>C(Q,null,[o(ll,U({id:ke.value,ref:T,modelValue:f.value,"onUpdate:modelValue":t=>f.value=t,activator:"parent",contentClass:"v-autocomplete__content",disabled:z.value,eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:l.transition,onAfterEnter:Fe,onAfterLeave:Pe},l.menuProps),{default:()=>[e&&o(al,U({ref:G,filterable:!0,selected:Ve.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:t=>t.preventDefault(),onKeydown:De,onFocusin:Re,onFocusout:Ae,tabindex:"-1",selectable:!0,"aria-live":"polite",color:l.itemColor??l.color},Se,l.listProps),{default:()=>[n["prepend-item"]?.(),!S.value.length&&!l.hideNoData&&(n["no-data"]?.()??o(ce,{key:"no-data",title:I(l.noDataText)},null)),o(tl,{ref:F,renderless:!0,items:S.value,itemKey:"value"},{default:t=>{let{item:a,index:y,itemRef:K}=t;const M=U(a.props,{ref:K,key:a.value,active:Y.value&&y===0?!0:void 0,onClick:()=>_(a,null)});return a.type==="divider"?n.divider?.({props:a.raw,index:y})??o(nl,U(a.props,{key:`divider-${y}`}),null):a.type==="subheader"?n.subheader?.({props:a.raw,index:y})??o(ul,U(a.props,{key:`subheader-${y}`}),null):n.item?.({item:a,index:y,props:M})??o(ce,U(M,{role:"option"}),{prepend:E=>{let{isSelected:g}=E;return C(Q,null,[l.multiple&&!l.hideSelected?o(ol,{key:a.value,modelValue:g,ripple:!1,tabindex:"-1"},null):void 0,a.props.prependAvatar&&o(rl,{image:a.props.prependAvatar},null),a.props.prependIcon&&o(W,{icon:a.props.prependIcon},null)])},title:()=>p.value?a.title:sl("v-autocomplete",a.title,ge(a)?.title)})}}),n["append-item"]?.()]})]}),s.value.map((t,a)=>{function y(g){g.stopPropagation(),g.preventDefault(),_(t,!1)}const K={"onClick:close":y,onKeydown(g){g.key!=="Enter"&&g.key!==" "||(g.preventDefault(),g.stopPropagation(),y(g))},onMousedown(g){g.preventDefault(),g.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},M=O.value?!!n.chip:!!n.selection,E=M?il(O.value?n.chip({item:t,index:a,props:K}):n.selection({item:t,index:a})):void 0;if(!(M&&!E))return C("div",{key:t.value,class:vl(["v-autocomplete__selection",a===i.value&&["v-autocomplete__selection--selected",u.value]]),style:cl(a===i.value?h.value:{})},[O.value?n.chip?o(dl,{key:"chip-defaults",defaults:{VChip:{closable:l.closableChips,size:"small",text:t.title}}},{default:()=>[E]}):o(he,U({key:"chip",closable:l.closableChips,size:"small",text:t.title,disabled:t.props.disabled},K),null):E??C("span",{class:"v-autocomplete__selection-text"},[t.title,l.multiple&&a<s.value.length-1&&C("span",{class:"v-autocomplete__selection-comma"},[P(",")])])])})]),"append-inner":function(){for(var t=arguments.length,a=new Array(t),y=0;y<t;y++)a[y]=arguments[y];return C(Q,null,[n["append-inner"]?.(...a),l.menuIcon?o(W,{class:"v-autocomplete__menu-icon",color:d.value?.fieldIconColor,icon:l.menuIcon,onMousedown:Ie,onClick:el,"aria-label":ue.value,title:ue.value,tabindex:"-1"},null):void 0])}})}),Qe({isFocused:V,isPristine:p,menu:f,search:v,filteredItems:X,select:_},d)}}),Vl={key:0,class:"card1 pa-6"},kl={class:"d-flex align-center"},wl={class:"d-flex flex-wrap"},xl={__name:"userPermissions",setup(l){const R=x(""),n=x(null),I=x(null),d=x(!1),V=x([]),p=x([]),D=x([]),T=b(()=>D.value.filter(c=>!p.value.some(u=>u.keyNo===c.keyNo)));fl(async()=>{try{const c=await L.get("api/Users/tissUserInfo");V.value=c.data}catch(c){console.error("載入使用者清單失敗:",c)}});const F=async()=>{if(n.value)try{const c=await L.get(`api/UserUsers/${n.value}/userDown`);p.value=c.data}catch(c){console.error("載入可檢視者清單失敗:",c)}},i=async c=>{if(R.value=c,!c||c.length<2){D.value=[];return}const u="userSearchCache",h=sessionStorage.getItem(u);if(h){D.value=JSON.parse(h);return}try{const v=await L.get("api/tissUser/list",{params:{query:c}});D.value=v.data,sessionStorage.setItem(u,JSON.stringify(v.data))}catch(v){console.error("搜尋使用者失敗:",v)}},A=async()=>{if(!(!I.value||!n.value))try{await L.post(`api/UserUsers/${n.value}/${I.value}`),await F(),I.value=null,R.value="",d.value=!1}catch(c){console.error("新增可檢視者失敗:",c)}},q=async c=>{if(n.value)try{await L.delete(`api/UserUsers/${n.value}/${c}`),p.value=p.value.filter(u=>u.keyNo!==c)}catch(u){console.error("刪除可檢視者失敗:",u)}};return(c,u)=>(H(),ae("div",null,[o(me,null,{default:k(()=>[o(J,{cols:"4"},{default:k(()=>[o(pe,{modelValue:w(n),"onUpdate:modelValue":[u[0]||(u[0]=h=>ve(n)?n.value=h:null),F],items:w(V),"item-title":"userName","item-value":"keyNo",variant:"outlined",density:"compact",label:"選擇使用者"},null,8,["modelValue","items"])]),_:1}),o(J,{cols:"12",md:"4",class:"d-flex justify-end"})]),_:1}),w(n)?(H(),ae("section",Vl,[o(me,{class:"align-center mb-4"},{default:k(()=>[o(J,{cols:"4"},{default:k(()=>[C("div",kl,[u[4]||(u[4]=C("h2",{class:"text-h5 text-primary me-4"},"人員資訊",-1)),P(" 共"+de(w(p).length)+"人 ",1)])]),_:1}),o(J,{cols:"6",class:"d-flex ga-4 align-center"},{default:k(()=>[te(o(fe,{icon:"mdi-plus",size:"small",varian:"",t:"text",color:"secondary",class:"ms-2 bg-blue",border:"",onClick:u[1]||(u[1]=h=>d.value=!0)},null,512),[[ne,!w(d)]]),te(o(pe,{modelValue:w(I),"onUpdate:modelValue":[u[2]||(u[2]=h=>ve(I)?I.value=h:null),A],items:w(T),"item-title":"userName","item-value":"keyNo",search:w(R),variant:"outlined",density:"compact",label:"搜尋使用者（至少輸入2個字）","onUpdate:search":i,clearable:"","hide-details":""},{"prepend-inner":k(()=>[o(W,null,{default:k(()=>[...u[5]||(u[5]=[P("mdi-magnify",-1)])]),_:1})]),_:1},8,["modelValue","items","search"]),[[ne,w(d)]]),te(o(fe,{variant:"text",class:"bg-blue",color:"primary",border:"",onClick:u[3]||(u[3]=h=>d.value=!1)},{default:k(()=>[...u[6]||(u[6]=[P(" 取消 ",-1)])]),_:1},512),[[ne,w(d)]])]),_:1})]),_:1}),C("div",wl,[(H(!0),ae(Q,null,pl(w(p),h=>(H(),hl(he,{key:h.keyNo,variant:"outlined",size:"default",color:"primary",class:"chip ma-1",closable:"","onClick:close":v=>q(h.keyNo)},{prepend:k(()=>[o(W,{size:"small"},{default:k(()=>[...u[7]||(u[7]=[P("mdi-account",-1)])]),_:1})]),default:k(()=>[P(" "+de(h.userName),1)]),_:2},1032,["onClick:close"]))),128))])])):ml("",!0)]))}},Dl=yl(xl,[["__scopeId","data-v-31ea34d2"]]);export{Dl as default};
